/*!
 *  dc 0.6.0
 *  http://dc-js.github.io/dc.js/
 *  Copyright 2012-2015 Nick Zhu & the dc.js Developers
 *  https://github.com/dc-js/dc.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(){function a(a,b){"use strict";var c={version:"0.6.0",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",NEGLIGIBLE_NUMBER:1e-10,ACCENT_CLASS:"accented",EVENT_DELAY:0},async:!1,logging:function(a){return arguments.length?void(c._logging=a):c._logging},_logging:!1,_lastFilteredSize:null,_sampledCount:0,_refreshDisabled:!1,_renderFlag:!1,_redrawFlag:!1,_renderId:0,_redrawId:0,_renderCount:0,_redrawCount:0,_renderIdStack:null,_redrawIdStack:null,_globalTransitionDuration:null,_redrawCallback:null,_startRenderTime:null,_startRedrawTime:null,_renderlet:null};c.chartRegistry=function(){function a(a){return a||(a=c.constants.DEFAULT_CHART_GROUP),b[a]||(b[a]=[]),a}var b={};return{has:function(a){for(var c in b)if(b[c].indexOf(a)>=0)return!0;return!1},register:function(c,d){d=a(d),b[d].push(c)},deregister:function(c,d){c.hasOwnProperty("sampling")&&c.sampling(!1),d=a(d);for(var e=0;e<b[d].length;e++)if(b[d][e].anchorName()===c.anchorName()){b[d].splice(e,1);break}},clear:function(a){a?delete b[a]:b={}},list:function(c){return c=a(c),b[c]}}}(),c.registerChart=function(a,b){c.chartRegistry.register(a,b)},c.deregisterChart=function(a,b){c.chartRegistry.deregister(a,b)},c.hasChart=function(a){return c.chartRegistry.has(a)},c.deregisterAllCharts=function(a){c.chartRegistry.clear(a)},c.disableRefresh=function(){c._refreshDisabled=!0},c.enableRefresh=function(){c._refreshDisabled=!1},c.filterAll=function(a){for(var b=c.chartRegistry.list(a),d=0;d<b.length;++d)b[d].filterAll()},c.refocusAll=function(a){for(var b=c.chartRegistry.list(a),d=0;d<b.length;++d)b[d].focus&&b[d].focus()},c.renderAll=function(a){if(!c._refreshDisabled){var b=c._renderId++,d=null===c._renderIdStack;if(c._renderIdStack=b,d){c._startRenderTime=new Date;for(var e=c.chartRegistry.list(a),f=0;f<e.length;++f)c._sampledCount>0?e[f].isCountChart()?e[f].render():e[f].renderAsync(b,e.length-1):e[f].renderAsync(b,e.length);null!==c._renderlet&&c._renderlet(a)}}},c.redrawAll=function(a,b){if(!c._refreshDisabled){var d=c._redrawId++,e=!1;if(void 0!==b)c._redrawCallback=b;else{var e=null===c._redrawIdStack;c._redrawIdStack=d}if(e||void 0!==b){c._startRedrawTime=new Date;for(var f=c.chartRegistry.list(a),g=0;g<f.length;++g)c._sampledCount>0?f[g].isCountChart()?f[g].redraw():f[g].redrawAsync(d,f.length-1):f[g].redrawAsync(d,f.length);null!==c._renderlet&&c._renderlet(a),$("body").trigger("updateFilterCounter")}}},c.disableTransitions=!1,c.transition=function(a,b,d,e){if(0>=b||void 0===b||c.disableTransitions)return a;var f=a.transition(e).duration(b);return"function"==typeof d&&d(f),f},c.optionalTransition=function(a,b,d,e){return a?function(a){return c.transition(a,b,d,e)}:function(a){return a}},c.afterTransition=function(a,b){if(a.empty()||!a.duration)b.call(a);else{var c=0;a.each(function(){++c}).each("end",function(){--c||b.call(a)})}},c.units={},c.units.integers=function(a,b){return Math.abs(b-a)},c.units.ordinal=function(a,b,c){return c},c.units.fp={},c.units.fp.precision=function(a){var b=function(a,d){var e=Math.abs((d-a)/b.resolution);return c.utils.isNegligible(e-Math.floor(e))?Math.floor(e):Math.ceil(e)};return b.resolution=a,b},c.round={},c.round.floor=function(a){return Math.floor(a)},c.round.ceil=function(a){return Math.ceil(a)},c.round.round=function(a){return Math.round(a)},c.override=function(a,b,c){var d=a[b];a["_"+b]=d,a[b]=c},c.renderlet=function(a){return arguments.length?(c._renderlet=a,c):c._renderlet},c.instanceOfChart=function(a){return a instanceof Object&&a.__dcFlag__&&!0},c.errors={},c.errors.Exception=function(a){var b=a||"Unexpected internal error";this.message=b,this.toString=function(){return b},this.stack=(new Error).stack},c.errors.Exception.prototype=Object.create(Error.prototype),c.errors.Exception.prototype.constructor=c.errors.Exception,c.errors.InvalidStateException=function(){c.errors.Exception.apply(this,arguments)},c.errors.InvalidStateException.prototype=Object.create(c.errors.Exception.prototype),c.errors.InvalidStateException.prototype.constructor=c.errors.InvalidStateException,c.errors.BadArgumentException=function(){c.errors.Exception.apply(this,arguments)},c.errors.BadArgumentException.prototype=Object.create(c.errors.Exception.prototype),c.errors.BadArgumentException.prototype.constructor=c.errors.BadArgumentException,c.dateFormat=a.time.format("%m/%d/%Y"),c.printers={},c.printers.filters=function(a){for(var b="",d=0;d<a.length;++d)d>0&&(b+=", "),b+=c.printers.filter(a[d]);return b},c.printers.filter=function(a){var b="";return"undefined"!=typeof a&&null!==a&&(a instanceof Array?a.length>=2?b="["+c.utils.printSingleValue(a[0])+" -> "+c.utils.printSingleValue(a[1])+"]":a.length>=1&&(b=c.utils.printSingleValue(a[0])):b=c.utils.printSingleValue(a)),b},c.pluck=function(a,b){return b?function(c,d){return b.call(c,c[a],d)}:function(b){return b[a]}},c.utils={},c.utils.printSingleValue=function(a){var b=""+a;return a instanceof Date?b=c.dateFormat(a):"string"==typeof a?b=a:c.utils.isFloat(a)?b=c.utils.printSingleValue.fformat(a):c.utils.isInteger(a)&&(b=Math.round(a)),b},c.utils.printSingleValue.fformat=a.format(".2f"),c.utils.add=function(a,b){if("string"==typeof b&&(b=b.replace("%","")),a instanceof Date){"string"==typeof b&&(b=+b);var c=new Date;return c.setTime(a.getTime()),c.setDate(a.getDate()+b),c}if("string"==typeof b){var d=+b/100;return a>0?a*(1+d):a*(1-d)}return a+b},c.utils.subtract=function(a,b){if("string"==typeof b&&(b=b.replace("%","")),a instanceof Date){"string"==typeof b&&(b=+b);var c=new Date;return c.setTime(a.getTime()),c.setDate(a.getDate()-b),c}if("string"==typeof b){var d=+b/100;return 0>a?a*(1+d):a*(1-d)}return a-b},c.utils.isNumber=function(a){return a===+a},c.utils.isFloat=function(a){return a===+a&&a!==(0|a)},c.utils.isInteger=function(a){return a===+a&&a===(0|a)},c.utils.isNegligible=function(a){return!c.utils.isNumber(a)||a<c.constants.NEGLIGIBLE_NUMBER&&a>-c.constants.NEGLIGIBLE_NUMBER},c.utils.clamp=function(a,b,c){return b>a?b:a>c?c:a};var d=0;return c.utils.uniqueId=function(){return++d},c.utils.nameToId=function(a){return parseFloat(a)?a:a.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},c.utils.appendOrSelect=function(a,b,c){c=c||b;var d=a.select(b);return d.empty()&&(d=a.append(c)),d},c.utils.safeNumber=function(a){return c.utils.isNumber(+a)?+a:0},c.logger={},c.logger.enableDebugLog=!1,c.logger.warn=function(a){return console&&(console.warn?console.warn(a):console.log&&console.log(a)),c.logger},c.logger.debug=function(a){return c.logger.enableDebugLog&&console&&(console.debug?console.debug(a):console.log&&console.log(a)),c.logger},c.logger.deprecate=function(a,b){function d(){return e||(c.logger.warn(b),e=!0),a.apply(this,arguments)}var e=!1;return d},c.events={current:null},c.events.trigger=function(a,b){return b?(c.events.current=a,void setTimeout(function(){a===c.events.current&&a()},b)):void a()},c.filters={},c.filters.RangedFilter=function(a,b){var c=new Array(a,b);return c.isFiltered=function(a){return a>=this[0]&&a<this[1]},c.filterType="RangedFilter",c},c.filters.TwoDimensionalFilter=function(a){if(null===a)return null;var b=a;return b.isFiltered=function(a){return a.length&&a.length===b.length&&a[0]===b[0]&&a[1]===b[1]},b.filterType="TwoDimensionalFilter",b},c.filters.RangedTwoDimensionalFilter=function(a){if(null===a)return null;var b,c=a;return b=c[0]instanceof Array?[[Math.min(a[0][0],a[1][0]),Math.min(a[0][1],a[1][1])],[Math.max(a[0][0],a[1][0]),Math.max(a[0][1],a[1][1])]]:[[a[0],-(1/0)],[a[1],1/0]],c.isFiltered=function(a){var c,d;if(a instanceof Array){if(2!==a.length)return!1;c=a[0],d=a[1]}else c=a,d=b[0][1];return c>=b[0][0]&&c<b[1][0]&&d>=b[0][1]&&d<b[1][1]},c.filterType="RangedTwoDimensionalFilter",c},c.baseMixin=function(d){function e(){n&&n.attr("width",d.width()).attr("height",d.height())}function f(){return n=d.root().append("div").attr("class","svg-wrapper").append("svg"),e(),n}function g(){m&&m.style("height",d.height()+"px")}function h(a){if(!d[a]||!d[a]())throw new c.errors.InvalidStateException("Mandatory attribute chart."+a+" is missing on chart[#"+d.anchorName()+"]")}function i(){if(d.dimension()&&d.dimension().filter){var a=W(d.dimension(),U);U=a?a:U}}d.__dcFlag__=c.utils.uniqueId();var j,k;d.dataCache=null;var l,m,n,o,p,q,r,s,t,u=!1,v=null,w=null,x=null,y=null,z=200,A=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().width;return b&&b>z?b:z},B=A,C=200,D=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().height;return b&&b>C?b:C},E=D,F=c.pluck("key0"),G=c.pluck("key0"),H=c.pluck("key0"),I=!1,J=c.pluck("val"),K=!1,L=function(a){return d.keyAccessor()(a)+": "+d.valueAccessor()(a)},M=!0,N=!0,O=500,P=c.printers.filters,Q=["dimension","group"],R=c.constants.DEFAULT_CHART_GROUP,S=a.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition");d._colorLegend=null;var T=0;d.isCountChart=function(){return!1};var U=[],V=!1,W=function(a,b){return"crossfilter"==a.type?b:(0===b.length?(a.filterAll(V),$(a).trigger("filter-clear")):d.hasOwnProperty("rangeFocused")?a.filterMulti(b,d.rangeFocused()):a.filterMulti(b),b)},X=function(a){return null!=d.dataCache?d.dataCache:a.all()},Y=function(a,b){a.allAsync(b)};d.height=function(b){return arguments.length?(E=a.functor(b||D),d):E(m.node())},d.width=function(b){return arguments.length?(B=a.functor(b||A),d):B(m.node())},d.accent=function(){},d.unAccent=function(){},d.minWidth=function(a){return arguments.length?(z=a,d):z},d.minHeight=function(a){return arguments.length?(C=a,d):C},d.dimension=function(a){return arguments.length?(j=a,d.expireCache(),d):j},d.data=function(b){return arguments.length?(X=a.functor(b),d.expireCache(),d):X.call(d,k)},d.dataAsync=function(a){return Y.call(d,k,a)},d.setDataAsync=function(a){return Y=a,d},d.group=function(a,b){return arguments.length?(k=a,d._groupName=b,d.expireCache(),d):k},d.ordering=function(a){return arguments.length?(H=a,q=b.quicksort.by(H),d.expireCache(),d):H},d._computeOrderedGroups=function(a){var b=a.slice(0);return b},d.filterAll=function(a){return V=void 0!=a&&1==a?!0:!1,d.filter(null)},d.select=function(a){return m.select(a)},d.selectAll=function(a){return m?m.selectAll(a):null},d.anchor=function(b,e){if(!arguments.length)return l;if(c.instanceOfChart(b))l=b.anchor(),m=b.root(),o=!0;else{if(!b)throw new c.errors.BadArgumentException("parent must be defined");l=b.select&&b.classed?b.node():b,m=a.select(l),m.classed(c.constants.CHART_CLASS,!0),c.registerChart(d,e),o=!1}return R=e,d},d.anchorName=function(){var a=d.anchor();return a&&a.id?a.id:a&&a.replace?a.replace("#",""):"dc-chart"+d.chartID()},d.root=function(a){return arguments.length?(m=a,d):m},d.svg=function(a){return arguments.length?(n=a,d):n},d.resetSvg=function(){return d.select(".svg-wrapper").remove(),f()},d.popup=function(a){return arguments.length?(p=a,d):p},d.generatePopup=function(){return d.select(".chart-popup").remove(),p=d.root().append("div").attr("class","chart-popup"),p.append("div").attr("class","chart-popup-box"),p},d.measureLabelsOn=function(a){return arguments.length?(I=a,d):I},d.isTargeting=function(a){return arguments.length?(u=a,d):u},d.colorByExpr=function(a){return arguments.length?(v=a,d):v},d.filterPrinter=function(a){return arguments.length?(P=a,d):P},d.controlsUseVisibility=function(a){return arguments.length?(N=a,d):N},d.turnOnControls=function(){if(m){var a=d.controlsUseVisibility()?"visibility":"display";d.selectAll(".reset").style(a,null),d.selectAll(".filter").text(P(d.filters())).style(a,null)}return d},d.turnOffControls=function(){if(m){var a=d.controlsUseVisibility()?"visibility":"display",b=d.controlsUseVisibility()?"hidden":"none";d.selectAll(".reset").style(a,b),d.selectAll(".filter").style(a,b).text(d.filter())}return d},d.transitionDuration=function(a){return arguments.length?(O=a,d):null!=c._globalTransitionDuration?c._globalTransitionDuration:O},d._mandatoryAttributes=function(a){return arguments.length?(Q=a,d):Q},d.renderAsync=function(a,b){if(!c._refreshDisabled){d.hasOwnProperty("setSample")&&d.setSample();var e=T++,f=$.proxy(d.render,this,e,a,b);d.dataAsync([f])}},d.render=function(a,b,e,f){if(!c._refreshDisabled){d.dataCache=void 0!==f?f:null,g(),S.preRender(d),Q&&Q.forEach(h);try{var i=d._doRender()}catch(j){console.error(j)}if(r&&d.colors().domain&&r.render(),d._colorLegend&&d._colorLegend.render(),d.generatePopup(),d._activateRenderlets("postRender"),void 0!==b&&++c._renderCount==e){if(c._logging){var k=new Date,l=k-c._startRenderTime;console.log("Render elapsed: "+l+" ms")}c._renderCount=0,c._globalTransitionDuration=null;var m=null==c._renderIdStack||c._renderIdStack==b;c._renderIdStack=null,m||c.renderAll()}return i}},d._activateRenderlets=function(a){S.pretransition(d),d.transitionDuration()>0&&n?n.transition().duration(d.transitionDuration()).each("end",function(){S.renderlet(d),a&&S[a](d)}):(S.renderlet(d),a&&S[a](d))},d.redrawAsync=function(a,b){if(!c._refreshDisabled){d.hasOwnProperty("setSample")&&d.setSample();var e=T++,f=$.proxy(d.redraw,this,e,a,b);d.dataAsync([f])}},d.redraw=function(a,b,f,g){if(!c._refreshDisabled){d.dataCache=void 0!==g?g:null,e(),S.preRedraw(d);try{var h=d._doRedraw()}catch(i){console.error(i)}if(r&&d.colors().domain&&r.render(),d._colorLegend&&d._colorLegend.render(),d._activateRenderlets("postRedraw"),void 0!==b&&++c._redrawCount==f){if(c._logging){var j=new Date,k=j-c._startRedrawTime;console.log("Redraw elapsed: "+k+" ms")}c._redrawCount=0,c._globalTransitionDuration=null;var l=null==c._redrawIdStack||c._redrawIdStack==b;if(c._redrawIdStack=null,null!=c._redrawCallback){var m=c._redrawCallback;c._redrawCallback=null,m()}else l||c.redrawAll()}return h}},d.commitHandler=function(a){return arguments.length?(s=a,d):s},d.redrawGroup=function(){return s?s(!1,function(a,b){a?console.log(a):c.redrawAll(d.chartGroup())}):c.redrawAll(d.chartGroup()),d},d.renderGroup=function(){return s?s(!1,function(a,b){a?console.log(a):c.renderAll(d.chartGroup())}):c.renderAll(d.chartGroup()),d},d._invokeFilteredListener=function(a){void 0!==a&&S.filtered(d,a)},d._invokeZoomedListener=function(){S.zoomed(d)};var Z=function(a,b){return null===b||"undefined"==typeof b?a.length>0:a.some(function(a){return a>=b&&b>=a})};d.hasFilterHandler=function(a){return arguments.length?(Z=a,d):Z},d.hasFilter=function(a){return Z(U,a)};var _=function(a,b){for(var c=0;c<a.length;c++)if(a[c]<=b&&a[c]>=b){a.splice(c,1);break}return a};d.removeFilterHandler=function(a){return arguments.length?(_=a,d):_};var aa=function(a,b){return a.push(b),a};d.addFilterHandler=function(a){return arguments.length?(aa=a,d):aa};var ba=function(a){return[]};return d.resetFilterHandler=function(a){return arguments.length?(ba=a,d):ba},d.replaceFilter=function(a){U=[],d.filter(a)},d.filter=function(a){return arguments.length?(a instanceof Array&&a[0]instanceof Array&&!a.isFiltered?a[0].forEach(function(a){d.hasFilter(a)?_(U,a):aa(U,a)}):null===a?U=ba(U):d.hasFilter(a)?_(U,a):aa(U,a),i(),d._invokeFilteredListener(a),null!==m&&d.hasFilter()?d.turnOnControls():d.turnOffControls(),d):U.length>0?U[0]:null},d.filters=function(){return U},d.accentSelected=function(b){a.select(b).classed(c.constants.ACCENT_CLASS,!0)},d.unAccentSelected=function(b){a.select(b).classed(c.constants.ACCENT_CLASS,!1)},d.highlightSelected=function(b){a.select(b).classed(c.constants.SELECTED_CLASS,!0),a.select(b).classed(c.constants.DESELECTED_CLASS,!1)},d.fadeDeselected=function(b){a.select(b).classed(c.constants.SELECTED_CLASS,!1),a.select(b).classed(c.constants.DESELECTED_CLASS,!0)},d.resetHighlight=function(b){a.select(b).classed(c.constants.SELECTED_CLASS,!1),a.select(b).classed(c.constants.DESELECTED_CLASS,!1)},d.onClick=function(a){var b=d.keyAccessor()(a);c.events.trigger(function(){d.filter(b),d.redrawGroup()})},d.filterHandler=function(a){return arguments.length?(W=a,d):W},d._doRender=function(){return d},d._doRedraw=function(){return d},d.legendables=function(){return[]},d.legendablesContinuous=function(){for(var b=[],c=d.colors().domain(),e=c[1]-c[0],f=d.colors().range(),g=f.length,h=a.format(","),i=0;g>i;i++){var j=i/g*e+c[0];u?j="%"+(100*parseFloat(j)).toFixed(2):"count(*)"===v?j=parseInt(j):(j=parseFloat(j).toFixed(2),j=j>=1e3?Math.round(j):j),b.push({color:f[i],value:isNaN(j)?j:h(j)})}return b},d.legendLock=function(a){return arguments.length?(w=a,d):w},d.legendUnlock=function(a){return arguments.length?(x=a,d):x},d.legendInputChange=function(a){return arguments.length?(y=a,d):y},d.legendHighlight=function(){},d.legendReset=function(){},d.legendToggle=function(){},d.isLegendableHidden=function(){return!1},d.keyAccessor=function(a){return arguments.length?(F=a,d):F},d.valueAccessor=function(a){return arguments.length?(J=a,d):J},d.label=function(a,b){return arguments.length?(G=a,(void 0===b||b)&&(K=!0),d):G},d.renderLabel=function(a){return arguments.length?(K=a,d):K},d.title=function(a){return arguments.length?(L=a,d):L},d.renderTitle=function(a){return arguments.length?(M=a,d):M},d.renderlet=c.logger.deprecate(function(a){return d.on("renderlet."+c.utils.uniqueId(),a),d},'chart.renderlet has been deprecated.  Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),d.chartGroup=function(a){return arguments.length?(o||c.deregisterChart(d,R),R=a,o||c.registerChart(d,R),d):R},d.expireCache=function(){return d},d.legend=function(a){return arguments.length?(r=a,r.parent(d),d):r},d.legendContinuous=function(a){return arguments.length?(t=a,t.parent(d),d):t},d.chartID=function(){return d.__dcFlag__},d.options=function(a){var b=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(var e in a)"function"==typeof d[e]?a[e]instanceof Array&&-1!==b.indexOf(e)?d[e].apply(d,a[e]):d[e].call(d,a[e]):c.logger.debug("Not a valid option setter name: "+e);return d},d.on=function(a,b){return S.on(a,b),d},d},c.marginMixin=function(a){var b={top:10,right:50,bottom:48,left:60};return a.margins=function(c){return arguments.length?(b=c,a):b},a.effectiveWidth=function(){return a.width()-a.margins().left-a.margins().right},a.effectiveHeight=function(){return a.height()-a.margins().top-a.margins().bottom},a},c.colorMixin=function(b){var c=a.scale.category20c(),d=!0,e=function(a){return b.keyAccessor()(a)};return b.colors=function(d){return arguments.length?(c=d instanceof Array?a.scale.quantize().range(d):a.functor(d),b):c},b.ordinalColors=function(c){return b.colors(a.scale.ordinal().range(c))},b.linearColors=function(c){return b.colors(a.scale.linear().range(c).interpolate(a.interpolateHcl))},b.colorAccessor=function(a){return arguments.length?(e=a,d=!1,b):e},b.defaultColorAccessor=function(){return d},b.colorDomain=function(a){return arguments.length?(c.domain(a),b):c.domain()},b.calculateColorDomain=function(){var d=[a.min(b.data(),b.colorAccessor()),a.max(b.data(),b.colorAccessor())];return c.domain(d),b},b.getColor=function(a,b){return c(e.call(this,a,b))},b.colorCalculator=function(a){return arguments.length?(b.getColor=a,b):b.getColor},b},c.mapMixin=function(b,d){function e(a){var b=[0,0];return b[0]=111319.49077777778*a[0],b[1]=6378136.999112157*Math.log(Math.tan(.00872664625997*(90+a[1]))),b}function f(a){b.initGeocoder()&&b.initGeocoder()(),c.enableRefresh(),b.render(),b.root().on("mouseleave",function(){F=!0}).on("mouseenter",function(){F=!1})}function g(a){if(void 0!==a&&null!==r&&null!=s){if("moveend"==a.type&&"moveend"==v)return;v=a.type;var d=(new Date).getTime(),f=b._map.getBounds(),g=e([f._sw.lng,f._sw.lat]),h=e([f._ne.lng,f._ne.lat]);if("move"===a.type){if(x&&(w=d,x=!1),y===1/0||y>d-w)return}else"moveend"===a.type&&(x=!0);w=d,r.filter([g[0],h[0]]),s.filter([g[1],h[1]]),c.redrawAll()}}function h(){mapboxgl.accessToken=m,b._map=new mapboxgl.Map({container:p,style:z,interactive:!0,center:A,zoom:B,maxBounds:H,preserveDrawingBuffer:!0}),b._map.dragRotate.disable(),b._map.touchZoomRotate.disableRotation(),b._map.on("load",f),b._map.on("move",g),b._map.on("moveend",g);var a=l(function(a){i(a,b.popupSearchRadius())},250);b._map.on("zoom click",function(b){a(b)}),b._map.on("mousemove",function(b){a(b),j()}),q=!0}function i(c,d){if(!F){for(var e=b.height(),f=Math.round(e-c.point.y),g=Math.round(c.point.x),h=[],i=d*d,l=-d;d>=l;l++)for(var m=-d;d>=m;m++)i>=l*l+m*m&&h.push(new TPixel({x:g+l,y:f+m}));var n=b.popupColumns().slice();n.length&&(n.push(t),n.push(u),con.getRowsForPixels(h,b.tableName(),n,[function(c){for(var d=null,h=1/0,i=0;i<c.length;i++)if(c[i].row_set.length){var l=(g-c[i].pixel.x)*(g-c[i].pixel.x)+(f-c[i].pixel.y)*(f-c[i].pixel.y);h>l&&(d=i,h=l)}if(null!==d&&b.select(".map-popup").empty()){b.x().range([0,b.width()-1]),b.y().range([0,b.height()-1]);var m=c[d],n=b.x()(m.row_set[0][t]),o=e-b.y()(m.row_set[0][u]),p=m.row_set[0],q=b.root().append("div").attr("class","map-popup");q.append("div").attr("class","map-point-wrap").append("div").attr("class","map-point").style({left:n+"px",top:o+"px"}).append("div").attr("class","map-point-gfx").style("background",function(){var a=null;return E&&b.colors().domain().forEach(function(b,c){b===p[E]&&(a=c)}),a?b.colors().range()[a]:"#27aeef"});var r=0;q.append("div").attr("class","map-popup-wrap").style({left:n+"px",top:o+"px"}).append("div").attr("class","map-popup-box").html(b.popupFunction()?C(p):k(p)).style("left",function(){var c=a.select(this).node().getBoundingClientRect().width,d=b.width()-(n+c/2)<0?b.width()-(n+c/2)-6:0>n-c/2?-(n-c/2)+6:0;return r=c/2-d,d+"px"}).classed("pop-down",function(){var b=a.select(this).node().getBoundingClientRect().height;return 8>o-(b+12)}).append("div").attr("class","map-popup-bridge").style("left",function(){return r+"px"}),b.root().on("mousewheel",j)}}]))}}function j(){b.select(".map-popup").empty()||(b.select(".map-popup-wrap").classed("removePopup",!0).on("animationend",function(){b.select(".map-popup").remove()}),b.select(".map-point").classed("removePoint",!0))}function k(a){var b="";for(var c in a)c!==u&&c!==t&&(b+='<div class="map-popup-item"><span class="popup-item-key">'+c+':</span><span class="popup-item-val"> '+a[c]+"</span></div>");return b}function l(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}var m="pk.eyJ1IjoibWFwZCIsImEiOiJjaWV1a3NqanYwajVsbmdtMDZzc2pneDVpIn0.cJnk8c2AxdNiRNZWtx5A9g",n=null,o=null,p=d;b._map=null;var q=!1,r=null,s=null,t=null,u=null,v=null,w=0,x=!0,y=100,z="mapbox://styles/mapbox/light-v8",A=[0,30],B=1,C=null,D=null,E=null,F=!1,G=[[180,-85],[-180,85]],H=mapboxgl.LngLatBounds.convert(G);return b.xDim=function(a){return arguments.length?(r=a,r&&(t=r.value()[0]),b):r},b.yDim=function(a){return arguments.length?(s=a,s&&(u=s.value()[0]),b):s},b.initGeocoder=function(a){return arguments.length?(D=a,b):D},b.colorBy=function(a){return arguments.length?(E=a,b):E},b.popupFunction=function(a){return arguments.length?(C=a,b):C},b.mapUpdateInterval=function(a){return arguments.length?(y=a,b):y},b.mapStyle=function(a){return arguments.length?(z=a,b._map&&b._map.setStyle(z),b):z},b.center=function(a){return arguments.length?(A=a,void(q&&b._map.setCenter(A))):A=b._map.getCenter()},b.zoom=function(a){return arguments.length?(B=a,void(q&&b._map.setZoom(B))):B=b._map.getZoom()},b.on("preRender",function(a){b.root().select(".mapboxgl-ctrl-bottom-right").remove();var c=a.width(),d=a.height();q||h(),(c!==n||d!==o)&&(b.root().select("#"+p+" canvas").attr("width",c).attr("height",d),n=c,o=d,b._map.resize(),g())}),h(),b},c.rasterMixin=function(a){a._vegaSpec={};var b=!1,d=null,e=[],f=0;return a.popupSearchRadius=function(b){return arguments.length?(f=b,a):f},a._resetVegaSpec=function(){a._vegaSpec.width=Math.round(a.width()),a._vegaSpec.height=Math.round(a.height()),a._vegaSpec.data=[{name:"table",sql:"select x, y from tweets;"}],d&&(a._vegaSpec.data[0].dbTableName=d),a._vegaSpec.scales=[],a._vegaSpec.marks=[]},a.popupColumns=function(b){return arguments.length?(e=b,a):e},a.tableName=function(b){return arguments.length?(d=b,a):d},a.sampling=function(d){return arguments.length?(d&&!b?c._sampledCount++:!d&&b&&c._sampledCount--,b=d,0==b&&a.dimension().samplingRatio(null),a):b},a.setSample=function(){b&&(null==c._lastFilteredSize?a.dimension().samplingRatio(null):a.dimension().samplingRatio(Math.min(a.cap()/c._lastFilteredSize,1)))},a._determineScaleType=function(a){return void 0!==a.rangeBand?"ordinal":void 0!==a.exponent?"power":void 0!==a.base?"log":void 0!==a.quantiles?"quantiles":void 0!==a.interpolate?"linear":"quantize"},a.vegaSpec=function(b){return arguments.length?(a._vegaSpec=b,a):a._vegaSpec},a},c.bubbleRasterChart=function(b,d,e){function f(){if(j._vegaSpec.scales=[],null!==n&&null!==o&&null!==r){var a=j._determineScaleType(n);j._vegaSpec.scales.push({name:"x",type:a,domain:n.domain(),range:"width"});var b=j._determineScaleType(o);j._vegaSpec.scales.push({name:"y",type:b,domain:o.domain(),range:"height"});var d=!1;if("function"==typeof r){var e=j._determineScaleType(r);j._vegaSpec.scales.push({name:"size",type:e,domain:r.domain(),range:r.range(),clamp:!0})}else d=!0;var f=!1,g=j.colors();if(null!==g)if(void 0!==g.domain){var h=j._determineScaleType(g);j._vegaSpec.scales.push({name:"color",type:h,domain:g.domain(),range:g.range(),"default":p})}else f=!0;j._vegaSpec.marks=[];var i={};if(i.type="points",i.from={data:"table"},i.properties={},i.properties.x={scale:"x",field:"x"},i.properties.y={scale:"y",field:"y"},f?i.properties.fillColor={value:j.colors()()}:i.properties.fillColor={scale:"color",field:"color"},d){var k=r;null!==s&&j.sampling()&&null!==c._lastFilteredSize&&(k=Math.round(s(Math.min(c._lastFilteredSize,j.cap()!==1/0?j.cap():c._lastFilteredSize)))),i.properties.size={value:k}}else i.properties.size={scale:"size",field:"size"};j._vegaSpec.marks.push(i)}}function g(){if(null!==j.xDim()&&null!==j.yDim()){null===n&&(n=a.scale.linear(),n.domain([.001,.999]));var b=j.xDim().getFilter();null!==b&&n.domain(b[0]),null===o&&(o=a.scale.linear(),o.domain([.001,.999]));var c=j.yDim().getFilter();null!==c&&o.domain(c[0])}}function h(a,b,c){b=b||"",c=c||512;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j)}var k=new Blob(e,{type:b});return k}function i(a,b){var c=j._map,d=q[b];if(void 0!==d)try{if(m){if(u)var e=h(a,"image/png"),f=URL.createObjectURL(e);else var f="data:image/png;base64,"+a;var g="overlay"+m,i=c.getSource(g);i.updateImage({url:f,coordinates:d})}else{m=b;var k="overlay"+m;if(u)var e=h(a,"image/png"),f=URL.createObjectURL(e);else var f="data:image/png;base64,"+a;c.addSource(k,{id:k,type:"image",url:f,coordinates:d}),c.addLayer({id:k,source:k,type:"raster",paint:{"raster-opacity":.85}})}}catch(l){console.log(l)}}var j=null,k=void 0!==d?d:!1,l=b.attributes.id.value;j=k?c.rasterMixin(c.mapMixin(c.colorMixin(c.capMixin(c.baseMixin({}))),l)):c.rasterMixin(c.colorMixin(c.capMixin(c.baseMixin({}))));var m=0,n=null,o=null,p="#22A7F0",q={},r=1,s=null,t=!1,u=navigator.userAgent.indexOf("Safari")>-1;return j.colors("#22A7F0"),j.x=function(a){return arguments.length?(n=a,j):n},j.y=function(a){return arguments.length?(o=a,j):o},j.r=function(a){return arguments.length?(r=a,j):r},j.dynamicR=function(a){return arguments.length?(s=a,j):s},j.defaultColor=function(a){return arguments.length?(p=a,j):p},j.setDataAsync(function(a,b){g();var c=j._map.getBounds(),d=[_.values(c.getNorthWest()),_.values(c.getNorthEast()),_.values(c.getSouthEast()),_.values(c.getSouthWest())];j._resetVegaSpec(),f();var e=null;e=j.cap()===1/0?a.allAsync(b):a.topAsync(j.cap(),void 0,JSON.stringify(j._vegaSpec),b),q[e]=d}),j.data(function(a){if(null!==j.dataCache)return j.dataCache;var b=j._map.getBounds(),c=[_.values(b.getNorthWest()),_.values(b.getNorthEast()),_.values(b.getSouthEast()),_.values(b.getSouthWest())];g(),j._resetVegaSpec(),f();var d=null;return d=j.cap()===1/0?a.all(JSON.stringify(j._vegaSpec)):a.top(j.cap(),void 0,JSON.stringify(j._vegaSpec)),q[d.nonce]=c,d}),j._doRender=function(){var a=j.data();i(a.image,a.nonce),t=!0},j._doRedraw=function(){if(!t)return j._doRender();var a=j.data();i(a.image,a.nonce)},j.anchor(b,e)},c.mapChart=function(a,b){var d=c.coordinateGridMixin({});return d.anchor(a,b)},c.coordinateGridMixin=function(b){function d(){Y=!0,ea&&(b.x().domain(p(b.x().domain(),B)),I&&b.x().domain(p(b.x().domain(),I.x().domain())));var a=b.x().domain(),d=c.filters.RangedFilter(a[0],a[1]);b.replaceFilter(d),b.rescale(),b.redraw(),I&&!q(b.filter(),I.filter())&&c.events.trigger(function(){I.replaceFilter(d),I.redraw()}),b._invokeZoomedListener(),c.events.trigger(function(){b.redrawGroup()},c.constants.EVENT_DELAY),Y=!q(a,B)}function e(a){ca=a;for(var c=b.stack().slice(),d=0;d<c.length;d++)0===d?b.group(c[d].group.binByTimeUnit(ca),c[d].name):b.stack(c[d].group.binByTimeUnit(ca),c[d].name,c[d].accessor);b.render()}function f(){this.select();var c=a.time.format.utc("%m-%d-%Y"),d=a.time.format.utc("%H:%M"),e=a.select(this),f=b.filter()||[b.xAxisMin(),b.xAxisMax()],g=e.attr("class").indexOf("start")>=0?0:1;e.property("value",e.classed("range-day")?c(f[g]):d(f[g]))}function g(){var d=a.select(this),e=d.attr("value"),f=d.property("value");if(isNaN(Date.parse(f)))return d.property("value",e),void this.blur();var g=new Date(f),h=new Date(g.getTime()-6e4*g.getTimezoneOffset()),i=d.attr("class").indexOf("start")>=0?0:1,j=b.rangeChart()?b.rangeChart():b,k=j.filter()||[j.xAxisMin(),j.xAxisMax()];k[i]=h<j.xAxisMin()?j.xAxisMin():h>j.xAxisMax()?j.xAxisMax():h,k.sort(function(a,b){return a-b}),k[0].getTime()===k[1].getTime()&&(k[1]=new Date(k[1].getTime()+864e5));var l=c.filters.RangedFilter(k[0],k[1]);j.replaceFilter(l),j.rescale(),j.redraw(),b.rangeChart()&&b.focus(l),this.blur()}function h(a,b){return!a||!b||a.length!==b.length||a.some(function(a,c){return a&&b[c]?a.toString()!==b[c].toString():a===b[c]})}function i(c,d){b.isOrdinal()?(b.elasticX()||0===A.domain().length)&&A.domain(b._ordinalXDomain()):b.elasticX()&&A.domain([b.xAxisMin(),b.xAxisMax()]);var e=A.domain();(d||h(D,e))&&b.rescale(),D=e,b.isOrdinal()?A.rangeBands([0,b.xAxisLength()],la,b._useOuterPadding()?ka:0):A.range([0,b.xAxisLength()]);var f=a.time.format.utc.multi([[".%L",function(a){return a.getUTCMilliseconds()}],[":%S",function(a){return a.getUTCSeconds()}],["%I:%M",function(a){return a.getUTCMinutes()}],["%I %p",function(a){return a.getUTCHours()}],["%a %d",function(a){return a.getUTCDay()&&1!=a.getUTCDate()}],["%b %d",function(a){return 1!=a.getUTCDate()}],["%b",function(a){return a.getUTCMonth()}],["%Y",function(){return!0}]]);K=K.scale(b.x()).tickFormat(b.x().domain()[0]instanceof Date?f:null),K.ticks(b.effectiveWidth()/K.scale().ticks().length<64?Math.ceil(b.effectiveWidth()/64):10),j(c)}function j(a){var d=a.selectAll("g."+u);if(X){d.empty()&&(d=a.insert("g",":first-child").attr("class",s+" "+u).attr("transform","translate("+b.margins().left+","+b.margins().top+")"));var e=K.tickValues()?K.tickValues():"function"==typeof A.ticks?A.ticks(K.ticks()[0]):A.domain(),f=d.selectAll("line").data(e),g=f.enter().append("line").attr("x1",function(a){return A(a)}).attr("y1",b._xAxisY()-b.margins().top).attr("x2",function(a){return A(a)}).attr("y2",0).attr("opacity",0);c.transition(g,b.transitionDuration()).attr("opacity",1),c.transition(f,b.transitionDuration()).attr("x1",function(a){return A(a)}).attr("y1",b._xAxisY()-b.margins().top).attr("x2",function(a){return A(a)}).attr("y2",0),f.exit().remove()}else d.selectAll("line").remove()}function k(){return b._xAxisY()-b.margins().top}function l(){return b.anchorName().replace(/[ .#=\[\]]/g,"-")+"-clip"}function m(){var a=c.utils.appendOrSelect(x,"defs"),d=l(),e=c.utils.appendOrSelect(a,"#"+d,"clipPath").attr("id",d),f=2*ja;c.utils.appendOrSelect(e,"rect").attr("width",b.xAxisLength()+f).attr("height",b.yAxisHeight()+f).attr("transform","translate(-"+ja+", -"+ja+")");
}function n(a){b.isOrdinal()&&(U=!1),i(b.g(),a),b._prepareYAxis(b.g()),b.plotData(),(b.elasticX()||Z||a)&&b.renderXAxis(b.g()),(b.elasticY()||Z||a)&&b.renderYAxis(b.g()),a?b.renderBrush(b.g(),!1):b.redrawBrush(b.g(),Z),b.fadeDeselectedArea(),Z=!1}function o(){ia?b._enableMouseZoom():ha&&b._disableMouseZoom()}function p(b,c){var d=[];return d[0]=a.max([b[0],c[0]]),d[1]=a.min([b[1],c[1]]),d}function q(a,b){return a||b?a&&b?0===a.length&&0===b.length?!0:a[0].valueOf()===b[0].valueOf()&&a[1].valueOf()===b[1].valueOf()?!0:!1:!1:!0}function r(a){return a instanceof Array&&a.length>1}var s="grid-line",t="horizontal",u="vertical",v=12,w=!1;b=c.colorMixin(c.marginMixin(c.baseMixin(b))),b.colors(a.scale.category10()),b._mandatoryAttributes().push("x");var x,y,z,A,B,C,D,E,F,G,H,I,J,K=a.svg.axis().orient("bottom"),L=c.units.integers,M=0,N=!1,O=0,P=a.svg.axis().orient("left"),Q=0,R=!1,S=0,T=a.svg.brush(),U=!0,V=!1,W=!1,X=!1,Y=!1,Z=!1,$=!1,_=!1,aa=!1,ba=[{val:"auto",label:"auto",numSeconds:null},{val:"year",label:"1y",numSeconds:31536e3},{val:"quarter",label:"1q",numSeconds:10368e3},{val:"month",label:"1mo",numSeconds:2592e3},{val:"week",label:"1w",numSeconds:604800},{val:"day",label:"1d",numSeconds:86400},{val:"hour",label:"1h",numSeconds:3600},{val:"minute",label:"1m",numSeconds:60},{val:"second",label:"1s",numSeconds:1}],ca="auto",da=[1,1/0],ea=!0,fa=a.behavior.zoom().on("zoom",d),ga=a.behavior.zoom().on("zoom",null),ha=!1,ia=!1,ja=0,ka=.5,la=0,ma=!1;return b.rescale=function(){return H=void 0,Z=!0,b},b.resizing=function(){return Z},b.rangeChart=function(a){return arguments.length?(I=a,I.focusChart(b),b):I},b.zoomScale=function(a){return arguments.length?(da=a,b):da},b.zoomOutRestrict=function(a){return arguments.length?(da[0]=a?1:0,ea=a,b):ea},b._generateG=function(a){return x=void 0===a?b.svg():a,y=x.append("g"),z=y.append("g").attr("class","chart-body").attr("transform","translate("+b.margins().left+", "+b.margins().top+")").attr("clip-path","url(#"+l()+")"),y},b.g=function(a){return arguments.length?(y=a,b):y},b.mouseZoomable=function(a){return arguments.length?(ia=a,b):ia},b.chartBodyG=function(a){return arguments.length?(z=a,b):z},b.x=function(a){return arguments.length?(A=a,B=A.domain(),b.rescale(),b):A},b.xOriginalDomain=function(){return B},b.xUnits=function(a){return arguments.length?(L=a,b):L},b.xAxis=function(a){return arguments.length?(K=a,b):K},b.elasticX=function(a){return arguments.length?(N=a,b):N},b.xAxisPadding=function(a){return arguments.length?(M=a,b):M},b.xUnitCount=function(){if(void 0===H){var a=b.xUnits()(b.x().domain()[0],b.x().domain()[1],b.x().domain());H=a instanceof Array?a.length:a}return H},b.useRightYAxis=function(a){return arguments.length?(ma=a,b):ma},b.isOrdinal=function(){return b.xUnits()===c.units.ordinal},b._useOuterPadding=function(){return!0},b._ordinalXDomain=function(){var a=b._computeOrderedGroups(b.data());return a.map(b.keyAccessor())},b.updateRangeInput=function(){var c=a.time.format.utc("%b %d, %Y"),d=a.time.format.utc("%I:%M%p"),e=b.filter()||[b.xAxisMin(),b.xAxisMax()],f=b.root().selectAll(".range-display");f.select(".range-start-day").property("value",c(e[0])).attr("value",c(e[0])),f.select(".range-start-time").text(d(e[0])),f.select(".range-end-day").property("value",c(e[1])).attr("value",c(e[1])),f.select(".range-end-time").text(d(e[1]))},b.renderXAxis=function(a){var d=a.selectAll("g.x");d.empty()&&(d=a.append("g").attr("class","axis x").attr("transform","translate("+b.margins().left+","+b._xAxisY()+")"));var h=b.root();if(b.rangeInput()){var i=h.selectAll(".range-display");i.empty()&&(i=h.append("div").attr("class","range-display").style("right",b.margins().right+"px"),i.append("input").attr("class","range-start-day range-day").on("focus",f).on("change",g),i.append("span").attr("class","range-start-time range-time"),i.append("span").html(" &mdash; "),i.append("input").attr("class","range-end-day range-day").on("focus",f).on("change",g),i.append("span").attr("class","range-end-time range-time"),b.updateRangeInput())}var j=h.selectAll(".x-axis-label");if(j.empty()&&(j=h.append("div").attr("class","x-axis-label")),j.style("left",b.effectiveWidth()/2+b.margins().left+"px").text(b.xAxisLabel()),c.transition(d,b.transitionDuration()).attr("transform","translate("+b.margins().left+","+b._xAxisY()+")").call(K),b.binInput()){var k=h.selectAll(".bin-row");k.empty()&&(k=h.append("div").attr("class","bin-row").style("left",b.margins().left+"px")),k.html("").append("span").text("BIN:");var l=k.selectAll(".bin-row-item").data(ba).enter(),m=Math.abs((b.x().domain()[0].getTime()-b.x().domain()[1].getTime())/1e3);l.append("div").attr("class","bin-row-item").classed("inactive",function(a){return a.numSeconds&&m/a.numSeconds>1e3||a.numSeconds&&m/a.numSeconds<2?(ca===a.val&&e("auto"),!0):!1}).classed("active",function(a){return a.val===ca}).text(function(a){return a.label}).on("click",function(a){e(a.val)})}},b._xAxisY=function(){return b.height()-b.margins().bottom},b.xAxisLength=function(){return b.effectiveWidth()},b.xAxisLabel=function(a,c){return arguments.length?(C=a,b.margins().bottom-=O,O=void 0===c?v:c,b.margins().bottom+=O,b):C},b._prepareYAxis=function(c){if(void 0===E||b.elasticY()){void 0===E&&(E=a.scale.linear());var d=b.yAxisMin()||0,e=b.yAxisMax()||0;E.domain([d,e]).rangeRound([b.yAxisHeight(),0])}E.range([b.yAxisHeight(),0]),P=P.scale(E),P.ticks(b.effectiveHeight()/P.scale().ticks().length<16?Math.ceil(b.effectiveHeight()/16):10),ma&&P.orient("right"),b._renderHorizontalGridLinesForAxis(c,E,P)},b.renderYAxisLabel=function(a,c,d,e){var f=b.root(),g=f.selectAll(".y-axis-label");if(g.empty()&&(g=f.append("div").attr("class","y-axis-label")),""!==c){var h=b.rangeChart()?b.rangeChart().height()-b.rangeChart().margins().bottom+b.margins().bottom:0;g.style("top",(b.effectiveHeight()+h)/2+b.margins().top+"px").text(c)}},b.renderYAxisAt=function(a,d,e){var f=b.g().selectAll("g."+a);f.empty()&&(f=b.g().append("g").attr("class","axis "+a).attr("transform","translate("+e+","+b.margins().top+")")),c.transition(f,b.transitionDuration()).attr("transform","translate("+e+","+b.margins().top+")").call(d)},b.renderYAxis=function(){var a=ma?b.width()-b.margins().right:b._yAxisX();b.renderYAxisAt("y",P,a);var c=ma?b.width()-S:S,d=ma?90:-90;b.renderYAxisLabel("y",b.yAxisLabel(),d,c)},b._renderHorizontalGridLinesForAxis=function(a,d,e){var f=a.selectAll("g."+t);if(W){var g=e.tickValues()?e.tickValues():d.ticks(e.ticks()[0]);f.empty()&&(f=a.insert("g",":first-child").attr("class",s+" "+t).attr("transform","translate("+b.margins().left+","+b.margins().top+")"));var h=f.selectAll("line").data(g),i=h.enter().append("line").attr("x1",1).attr("y1",function(a){return d(a)}).attr("x2",b.xAxisLength()).attr("y2",function(a){return d(a)}).attr("opacity",0);c.transition(i,b.transitionDuration()).attr("opacity",1),c.transition(h,b.transitionDuration()).attr("x1",1).attr("y1",function(a){return d(a)}).attr("x2",b.xAxisLength()).attr("y2",function(a){return d(a)}),h.exit().remove()}else f.selectAll("line").remove()},b._yAxisX=function(){return b.useRightYAxis()?b.width()-b.margins().right:b.margins().left},b.yAxisLabel=function(a,c){return arguments.length?(F=a,b.margins().left-=S,S=void 0===c?v:c,b.margins().left+=S,b):F},b.y=function(a){return arguments.length?(E=a,b.rescale(),b):E},b.yAxis=function(a){return arguments.length?(P=a,b):P},b.elasticY=function(a){return arguments.length?(R=a,b):R},b.renderHorizontalGridLines=function(a){return arguments.length?(W=a,b):W},b.renderVerticalGridLines=function(a){return arguments.length?(X=a,b):X},b.xAxisMin=function(){var d=a.min(b.data(),function(a){return b.keyAccessor()(a)});return c.utils.subtract(d,M)},b.xAxisMax=function(){var d=a.max(b.data(),function(a){return b.keyAccessor()(a)});return c.utils.add(d,M)},b.yAxisMin=function(){var d=a.min(b.data(),function(a){return b.valueAccessor()(a)});return c.utils.subtract(d,Q)},b.yAxisMax=function(){var d=a.max(b.data(),function(a){return b.valueAccessor()(a)});return c.utils.add(d,Q)},b.yAxisPadding=function(a){return arguments.length?(Q=a,b):Q},b.yAxisHeight=function(){return b.effectiveHeight()},b.round=function(a){return arguments.length?(G=a,b):G},b._rangeBandPadding=function(a){return arguments.length?(la=a,b):la},b._outerRangeBandPadding=function(a){return arguments.length?(ka=a,b):ka},c.override(b,"filter",function(a){return arguments.length?(b._filter(a),a?b.brush().extent(a):b.brush().clear(),b):b._filter()}),b.brush=function(a){return arguments.length?(T=a,b):T},b.isBrushing=function(a){return arguments.length?(V=a,b):V},b.renderBrush=function(a){if(U){T.on("brush",b._brushing),T.on("brushstart",function(){V=!0,b._disableMouseZoom()}),T.on("brushend",function(){V=!1,o()});var c=a.append("g").attr("class","brush").attr("transform","translate("+b.margins().left+","+b.margins().top+")").call(T.x(b.x()));b.setBrushY(c,!1),b.setHandlePaths(c),b.hasFilter()&&b.redrawBrush(a,!1)}},b.setHandlePaths=function(a){a.selectAll(".resize").append("path").attr("d",b.resizeHandlePath)},b.setBrushY=function(a){a.selectAll(".brush rect").attr("height",k()),a.selectAll(".resize path").attr("d",b.resizeHandlePath)},b.extendBrush=function(){var a=T.extent();return b.round()&&(a[0]=a.map(b.round())[0],a[1]=a.map(b.round())[1],y.select(".brush").call(T.extent(a))),a},b.brushIsEmpty=function(a){return T.empty()||!a||a[1]<=a[0]},b._brushing=function(){var a=b.extendBrush();if(b.redrawBrush(y,!1),b.brushIsEmpty(a))c.events.trigger(function(){b.filter(null),b.redrawGroup()},c.constants.EVENT_DELAY),b.rangeInput()&&b.updateRangeInput(),b.focusChart()&&(b.focusChart().filter(null),b.focusChart().redraw());else{var d=c.filters.RangedFilter(a[0],a[1]);c.events.trigger(function(){c._globalTransitionDuration=10,b.replaceFilter(d),b.redrawGroup()},c.constants.EVENT_DELAY)}},b.redrawBrush=function(a,d){if(U){b.filter()&&(b.brush().empty()||b._redrawBrushFlag)&&(b._redrawBrushFlag=!1,b.brush().extent(b.filter()));var e=c.optionalTransition(d,b.transitionDuration())(a.select("g.brush"));b.setBrushY(e),e.call(b.brush().x(b.x()).extent(b.brush().extent()))}b.fadeDeselectedArea()},b.fadeDeselectedArea=function(){},b.resizeHandlePath=function(a){var b=+("e"===a),c=b?1:-1,d=k()/3;return"M"+.5*c+","+d+"A6,6 0 0 "+b+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+b+" "+.5*c+","+2*d+"ZM"+2.5*c+","+(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)},b.clipPadding=function(a){return arguments.length?(ja=a,b):ja},b._preprocessData=function(){},b._doRender=function(){return b._redrawBrushFlag=!0,b.resetSvg(),b._preprocessData(),b._generateG(),m(),n(!0),o(),w=!0,b},b._doRedraw=function(){return w?(b._preprocessData(),n(!1),m(),b):b._doRender()},b._enableMouseZoom=function(){ha=!0,fa.x(b.x()).scaleExtent(da).size([b.width(),b.height()]).duration(b.transitionDuration()),b.root().call(fa)},b._disableMouseZoom=function(){b.root().call(ga)},b.focus=function(a){r(a)?b.x().domain(a):b.x().domain(B),fa.x(b.x()),d()},b.refocused=function(){return Y},b.rangeFocused=function(a){return arguments.length?void($=a):$},b.rangeInput=function(a){return arguments.length?(_=a,b):_},b.binInput=function(a){return arguments.length?(aa=a,b):aa},b.focusChart=function(a){return arguments.length?(J=a,b.on("filtered",function(a){J.rangeFocused(!0),a.filter()?q(a.filter(),J.filter())||c.events.trigger(function(){J.focus(a.filter())}):c.events.trigger(function(){J.x().domain(J.xOriginalDomain())}),J.rangeFocused(!1)}),b):J},b.brushOn=function(a){return arguments.length?(U=a,b):U},b},c.stackMixin=function(b){function d(a,c){var d=a.accessor||b.valueAccessor();a.name=String(a.name||c),a.idx=c;var f=null!=b.dataCache?b.dataCache:a.group.all();return a.values=f.map(function(e,f){return{x:b.keyAccessor()(e,f),y:a.hidden?null:d(e,f),idx:c,data:e,layer:a.name,hidden:a.hidden}}),a.values=a.values.filter(e()),a.values}function e(){if(!b.x())return a.functor(!0);var c=b.x().domain();return b.isOrdinal()?function(){return!0}:b.elasticX()?function(){return!0}:function(a){return a.x>=c[0]&&a.x<=c[c.length-1]}}function f(a){var b=j.map(c.pluck("name")).indexOf(a);return j[b]}function g(){var a=b.data().map(function(a){return a.values});return Array.prototype.concat.apply([],a)}function h(a){return!a.hidden}var i=a.layout.stack().values(d),j=[],k={},l=!1,m=!1;return b.stack=function(a,c,d){if(!arguments.length)return j;arguments.length<=2&&(d=c);var e={group:a};return"string"==typeof c&&(e.name=c),"function"==typeof d&&(e.accessor=d),j.push(e),b},c.override(b,"group",function(a,c,d){return arguments.length?(j=[],k={},b.stack(a,c),d&&b.valueAccessor(d),b._group(a,c)):b._group()}),b.hidableStacks=function(a){return arguments.length?(l=a,b):l},b.hideStack=function(a){var c=f(a);return c&&(c.hidden=!0),b},b.showStack=function(a){var c=f(a);return c&&(c.hidden=!1),b},b.getValueAccessorByIndex=function(a){return j[a].accessor||b.valueAccessor()},b.yAxisMin=function(){var d=a.min(g(),function(a){return void 0===b.renderArea||b.renderArea()?a.y+a.y0<a.y0?a.y+a.y0:a.y0:a.y});return c.utils.subtract(d,b.yAxisPadding())},b.yAxisMax=function(){var d=a.max(g(),function(a){return void 0===b.renderArea||b.renderArea()?a.y+a.y0:a.y});return c.utils.add(d,b.yAxisPadding())},b.xAxisMin=function(){var d=a.min(g(),c.pluck("x"));return c.utils.subtract(d,b.xAxisPadding())},b.xAxisMax=function(){var d=a.max(g(),c.pluck("x"));return c.utils.add(d,b.xAxisPadding())},c.override(b,"title",function(a,c){return a?"function"==typeof a?b._title(a):a===b._groupName&&"function"==typeof c?b._title(c):"function"!=typeof c?k[a]||b._title():(k[a]=c,b):b._title()}),b.stackLayout=function(a){return arguments.length?(i=a,b):i},b.data(function(){var a=j.filter(h);return a.length?b.stackLayout()(a):[]}),b._ordinalXDomain=function(){var a=g().map(c.pluck("data")),d=b._computeOrderedGroups(a);return d.map(b.keyAccessor())},b.colorByLayerId=function(a){return arguments.length?(m=a,b):m},b.colorAccessor(function(a){var b=null;return b=m?this.idx:this.layer||this.name||a.name||a.layer}),b.legendables=function(){return j.map(function(a,c){return{chart:b,name:a.name,hidden:a.hidden||!1,color:b.getColor.call(a,a.values,c)}})},b.isLegendableHidden=function(a){var b=f(a.name);return b?b.hidden:!1},b.legendToggle=function(a){l&&(b.isLegendableHidden(a)?b.showStack(a.name):b.hideStack(a.name),b.renderGroup())},b},c.capMixin=function(b){var d=1/0,e="Others",f=function(c){var d=a.sum(c,b.valueAccessor()),f=b.group().all(),g=a.sum(f,b.valueAccessor()),h=c.map(b.keyAccessor()),i=f.map(b.keyAccessor()),j=a.set(h),k=i.filter(function(a){return!j.has(a)});return g>d?c.concat([{others:k,key:e,value:g-d}]):c};return b.cappedKeyAccessor=function(a,c){return a.others?a.key0:b.keyAccessor()(a,c)},b.cappedValueAccessor=function(a,c){return a.others?a.value:b.valueAccessor()(a,c)},b.setDataAsync(function(a,b){d===1/0?a.allAsync(b):a.topAsync(d,void 0,void 0,b)}),c.async?(b.data(function(a,c){return d===1/0?(c.push(b.computeOrderedGroups.bind(this)),void a.allAsync(c)):void c.push(capCallback.bind(this))}),b.capCallback=function(a,c){var d=b._computeOrderedGroups(a);return f?f(d):d}):b.data(function(a){if(d===1/0)return null!=b.dataCache?b._computeOrderedGroups(b.dataCache):b._computeOrderedGroups(a.all());var c=null;return c=null!=b.dataCache?b.dataCache:a.top(d),c=b._computeOrderedGroups(c),f?f(c):c}),b.cap=function(a){return arguments.length?(d=a,b):d},b.othersLabel=function(a){return arguments.length?(e=a,b):e},b.othersGrouper=function(a){return arguments.length?(f=a,b):f},c.override(b,"onClick",function(a){a.others&&b.filter([a.others]),b._onClick(a)}),b},c.bubbleMixin=function(b){function d(a){b.selectAll("g."+b.BUBBLE_NODE_CLASS).each(function(c){c.key0===a&&b.accentSelected(this)})}function e(a){b.selectAll("g."+b.BUBBLE_NODE_CLASS).each(function(c){c.key0===a&&b.unAccentSelected(this)})}var f=.3,g=2;b.BUBBLE_NODE_CLASS="node",b.BUBBLE_CLASS="bubble",b.MIN_RADIUS=10,b.accent=d,b.unAccent=e,b=c.colorMixin(b),b.renderLabel(!0),b.setDataAsync(function(a,c){void 0!==b.cap()?a.topAsync(b.cap(),void 0,void 0,c):a.allAsync(c)}),b.data(function(a){return null!==b.dataCache?b.dataCache:a.top(void 0!==b.cap()?b.cap():1/0)});var h=a.scale.linear().domain([0,100]),i=function(a){return a.r};b.r=function(a){return arguments.length?(h=a,b):h},b.radiusValueAccessor=function(a){return arguments.length?(i=a,b):i},b.rMin=function(){var c=a.min(b.data(),function(a){return b.radiusValueAccessor()(a)});return c},b.rMax=function(){var c=a.max(b.data(),function(a){return b.radiusValueAccessor()(a)});return c},b.bubbleR=function(a){var c=b.radiusValueAccessor()(a),d=b.r()(c);return(isNaN(d)||0>=c)&&(d=0),d};var j=function(a){return b.label()(a)},k=function(a){return b.bubbleR(a)>g},l=function(a){return k(a)?"all":"none"};b._doRenderLabel=function(a){if(b.renderLabel()){var d=a.select("text");d.empty()&&(d=a.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",b.onClick)),d.attr("opacity",0).attr("pointer-events",l).text(j),c.transition(d,b.transitionDuration()).attr("opacity",1),b.hideOverlappedLabels()}},b.doUpdateLabels=function(a){if(b.renderLabel()){var d=a.selectAll("text").attr("pointer-events",l).text(j);c.transition(d,b.transitionDuration()).attr("opacity",1)}};var m=function(a){return b.title()(a)};return b._doRenderTitles=function(a){if(b.renderTitle()){var c=a.select("title");c.empty()&&a.append("title").text(m)}},b.doUpdateTitles=function(a){b.renderTitle()&&a.selectAll("title").text(m)},b.minRadius=function(a){return arguments.length?(b.MIN_RADIUS=a,b):b.MIN_RADIUS},b.minRadiusWithLabel=function(a){return arguments.length?(g=a,b):g},b.maxBubbleRelativeSize=function(a){return arguments.length?(f=a,b):f},b.fadeDeselectedArea=function(){b.hasFilter()?b.selectAll("g."+b.BUBBLE_NODE_CLASS).each(function(a){b.isSelectedNode(a)?b.highlightSelected(this):b.fadeDeselected(this)}):b.selectAll("g."+b.BUBBLE_NODE_CLASS).each(function(){b.resetHighlight(this)})},b.isSelectedNode=function(a){return b.hasFilter(a.key0)},b.onClick=function(a){var d=a.key0;c.events.trigger(function(){b.filter(d),b.redrawGroup()}),b.updatePopup(a)},b},c.pieChart=function(b,d){function e(){K=L?L:a.min([Z.width(),Z.height()])/2;var b,d=t(),e=v();if(a.sum(Z.data(),Z.valueAccessor())?(b=e(Z.data()),M.classed(T,!1)):(b=e([{key:U,value:1,others:[U]}]),M.classed(T,!0)),M){var g=M.selectAll("g."+S).data(b);f(g,d,b),l(b,d),p(g),s(),c.transition(M,Z.transitionDuration()).attr("transform","translate("+Z.cx()+","+Z.cy()+")")}}function f(a,b,c){var d=g(a);h(d,b),j(c,b)}function g(a){var b=a.enter().append("g").attr("class",function(a,b){return S+" _"+b}).classed("stroke-thick",F);return b}function h(a,b){var d=a.append("path").attr("fill",A).on("click",B).on("mouseenter",C).on("mousemove",E).on("mouseleave",D).attr("d",function(a,c){return G(a,c,b)});c.transition(d,Z.transitionDuration(),function(a){a.attrTween("d",y)})}function i(b,d){c.transition(b,Z.transitionDuration()).attr("transform",function(a){return H(a,d)});var e=!0;b.style("font-size",F()?"14px":"12px"),b.select(".value-dim").text(function(a){return Z.label()(a.data)}).html(function(b){var c=w(b),d=a.select(this).node().getBoundingClientRect().width,f=d>c?x(Z.label()(b.data),d,c):Z.label()(b.data);return""===f&&(e=!1),a.select(this.parentNode).classed("hide-label",!e),e?f:""});var f=a.format(",");Z.measureLabelsOn()&&b.select(".value-measure").text(function(a){return f(Z.measureValue(a.data))}).html(function(b){if(a.select(this.parentNode).classed("hide-label"))return"";var c=w(b),d=a.select(this).node().getBoundingClientRect().width;return d>c?x(f(Z.measureValue(b.data)),d,c):f(Z.measureValue(b.data))})}function j(a,b){if(Z.renderLabel()){var c=M.selectAll("g.pie-label").data(a);c.exit().remove();var d=c.enter().append("g").attr("class",function(a,b){var c="pie-label _"+b;return P&&(c+=" external"),c}).attr("transform",function(a){return H(a,b)}).on("click",B);d.append("text").attr("class","value-dim").attr("dy",Z.measureLabelsOn()?"0":".4em"),Z.measureLabelsOn()&&d.append("text").attr("class","value-measure").attr("dy","1.2em"),i(d,b),P&&Y&&k(a,b)}}function k(b,d){var e=M.selectAll("polyline."+S).data(b);e.enter().append("polyline").attr("class",function(a,b){return"pie-path _"+b+" "+S}),e.exit().remove(),c.transition(e,Z.transitionDuration()).attrTween("points",function(b){this._current=this._current||b;var c=a.interpolate(this._current,b);return this._current=c(0),function(b){var e=a.svg.arc().outerRadius(K-W+P).innerRadius(K-W),f=c(b);return[d.centroid(f),e.centroid(f)]}}).style("visibility",function(a){return a.endAngle-a.startAngle<1e-4?"hidden":"visible"})}function l(a,b){m(a,b),n(a,b),o(a)}function m(a,b){var d=M.selectAll("g."+S).data(a).select("path").attr("d",function(a,c){return G(a,c,b)});c.transition(d,Z.transitionDuration(),function(a){a.attrTween("d",y)}).attr("fill",A)}function n(a,b){if(Z.renderLabel()){var c=M.selectAll("g.pie-label").data(a);i(c,b),P&&Y&&k(a,b)}}function o(a){Z.renderTitle()&&M.selectAll("g."+S).data(a).select("title").text(function(a){return Z.title()(a.data)})}function p(a){a.exit().remove()}function q(a){Z.selectAll("g."+S).each(function(b){Z.cappedKeyAccessor(b.data)==a&&Z.accentSelected(this)})}function r(a){Z.selectAll("g."+S).each(function(b){Z.cappedKeyAccessor(b.data)==a&&Z.unAccentSelected(this)})}function s(){Z.hasFilter()?Z.selectAll("g."+S).each(function(a){u(a)?Z.highlightSelected(this):Z.fadeDeselected(this)}):Z.selectAll("g."+S).each(function(){Z.resetHighlight(this)})}function t(){return a.svg.arc().outerRadius(K-W).innerRadius(Z.innerRadius())}function u(a){return Z.hasFilter(Z.cappedKeyAccessor(a.data))}function v(){return a.layout.pie().sort(null).value(Z.cappedValueAccessor)}function w(a){var b=a.endAngle-a.startAngle;if(isNaN(b)||b*(K/2)<(Z.measureLabelsOn()?28:20))return 0;var c=t(),d=I(a,c),e=Math.abs(d[1]),f=d[0]*d[1]<0?a.startAngle:a.endAngle,g=d[1]>=0?Math.PI:d[0]<0?2*Math.PI:0,h=Math.tan(Math.abs(g-f)),i=h*e,j=2*(g>=a.startAngle&&g<a.endAngle?Math.abs(d[0])+i:Math.abs(d[0])-i),k=K-Z.innerRadius()-24;return j>k||0>j?k:j}function x(a,b,c){var d=a+"";if(d.length<4)return"";var e=d.length-Math.ceil((b-c)/(b/d.length)*1.25);return d.length-e>2&&(d=e>2?d.slice(0,e)+"&#8230;":""),d}function y(b){b.innerRadius=Z.innerRadius();var c=this._current;z(c)&&(c={startAngle:0,endAngle:0});var d=a.interpolate(c,b);return this._current=d(0),function(a){return G(d(a),0,t())}}function z(a){return!a||isNaN(a.startAngle)||isNaN(a.endAngle)}function A(a,b){return Z.getColor(a.data,b)}function B(a,b){M.attr("class")!==T&&Z.onClick(a.data,b)}function C(b,c){var d=Z.popup(),e=d.select(".chart-popup-box").html("");e.append("div").attr("class","popup-legend").style("background-color",A(b,c));var f=a.format(",");e.append("div").attr("class","popup-value").html(function(){return'<div class="popup-value-dim">'+Z.label()(b.data)+'</div><div class="popup-value-measure">'+f(parseFloat(Z.measureValue(b.data).toFixed(2)))+"</div>"}),d.classed("js-showPopup",!0)}function D(){Z.popup().classed("js-showPopup",!1)}function E(){var b=[0,0];b=a.mouse(this);var c=b[0]+Z.width()/2,d=b[1]+Z.height()/2,e=Z.popup().attr("style",function(){return"transform:translate("+c+"px,"+d+"px)"});e.select(".chart-popup-box").classed("align-right",function(){return c+a.select(this).node().getBoundingClientRect().width>Z.width()})}function F(){return $<Math.min(Z.width(),Z.height())}function G(a,b,c){var d=c(a,b);return d.indexOf("NaN")>=0&&(d="M0,0"),d}function H(b,c){var d;return d=P?a.svg.arc().outerRadius(K-W+P).innerRadius(K-W+P).centroid(b):I(b,c),isNaN(d[0])||isNaN(d[1])?"translate(0,0)":"translate("+d+")"}function I(b,c){var d;return d=P?a.svg.arc().outerRadius(K-W+P).innerRadius(K-W+P).centroid(b):0===V&&"donut"!=Q?a.svg.arc().outerRadius(K-W).innerRadius(K/5).centroid(b):c.centroid(b)}function J(b,c){Z.selectAll("g.pie-slice").each(function(d){b.name===d.data.key&&a.select(this).classed("highlight",c)})}var K,L,M,N,O,P,Q,R=.4,S="pie-slice",T="empty-chart",U="empty",V=0,W=0,X=R,Y=!1,Z=c.capMixin(c.colorMixin(c.baseMixin({}))),$=480,_=!1;return Z.redoSelect=s,Z.accent=q,Z.unAccent=r,Z.colorAccessor(Z.cappedKeyAccessor),Z.title(function(a){return Z.cappedKeyAccessor(a)+": "+Z.cappedValueAccessor(a)}),Z.slicesCap=Z.cap,Z.label(Z.cappedKeyAccessor),Z.renderLabel(!0),Z.transitionDuration(350),Z.measureValue=function(a){return Z.cappedValueAccessor(a)},Z.redoSelect=s,Z.accent=q,Z.unAccent=r,Z._doRender=function(){return Z.resetSvg(),M=Z.svg().append("g").attr("class","pie-wrapper").attr("transform","translate("+Z.cx()+","+Z.cy()+")"),e(),_=!0,Z},Z.externalRadiusPadding=function(a){return arguments.length?(W=a,Z):W},Z.innerRadius=function(a){return arguments.length?(V=a,Z):Q?"donut"===Q?(Math.min(Z.width(),Z.height())-W)/5:0:V},Z.pieStyle=function(a){return arguments.length?(Q=a,Z):Q},Z.radius=function(a){return arguments.length?(L=a,Z):L},Z.cx=function(a){return arguments.length?(N=a,Z):N||Z.width()/2},Z.cy=function(a){return arguments.length?(O=a,Z):O||Z.height()/2},Z._doRedraw=function(){return _?(e(),Z):Z._doRender()},Z.minAngleForLabel=function(a){return arguments.length?(X=a,Z):X},Z.emptyTitle=function(a){return 0===arguments.length?U:(U=a,Z)},Z.externalLabels=function(a){return 0===arguments.length?P:(P=a?a:void 0,Z)},Z.drawPaths=function(a){return 0===arguments.length?Y:(Y=a,Z)},Z.legendables=function(){return Z.data().map(function(a,b){var c={name:a.key0,data:a.value,others:a.others,chart:Z};return c.color=Z.getColor(a,b),c})},Z.legendHighlight=function(a){J(a,!0)},Z.legendReset=function(a){J(a,!1)},Z.legendToggle=function(a){Z.onClick({key:a.name,others:a.others})},Z.anchor(b,d)},c.barChart=function(b,d){function e(){var a=v.g().on("mouseout",function(){g()}).on("mousemove",function(){v.isBrushing()?i():f(a,this)})}function f(b,c){var d=[0,0];d=a.mouse(c);var e=d[0],f=d[1],g=e-v.margins().left,j=f-v.margins().top,k=[];b.selectAll(".stack").each(function(){var b=null,c=a.select(this).selectAll(".bar").style("fill-opacity",1);c[0].sort(function(b,c){return a.select(b).attr("x")-a.select(c).attr("x")}),c[0].some(function(c,d){var e=a.select(c);return g<e.attr("x")?!0:void(b={elm:e,datum:e.datum(),i:d})}),b&&Math.abs(b.elm.attr("x")-g)<A&&j>b.elm.attr("y")-32&&(b.elm.style("fill-opacity",.8),k.push(b))});k.length>0?h(k,e,f):i()}function g(){v.g().selectAll(".bar").style("fill-opacity",1),i()}function h(b,c,d){var e=a.format(","),f=v.popup().classed("hide-delay",!0),g=f.select(".chart-popup-box").html("").classed("popup-list",!0);g.append("div").attr("class","popup-header").text(v.xAxisLabel()+" "+b[0].datum.x);var h=g.selectAll(".popup-item").data(b).enter().append("div").attr("class","popup-item");h.append("div").attr("class","popup-legend").style("background-color",function(a){return v.getColor(a.datum,a.i)}),h.append("div").attr("class","popup-item-value").text(function(a){return e(parseFloat((a.datum.y+a.datum.y0).toFixed(2)))}),j(c,d),f.classed("js-showPopup",!0)}function i(){v.popup().classed("js-showPopup",!1)}function j(b,c){var d=v.popup().attr("style",function(){return"transform:translate("+b+"px,"+c+"px)"});d.select(".chart-popup-box").classed("align-left-center",!0).classed("align-right-center",function(){return b+(a.select(this).node().getBoundingClientRect().width+32)>v.width()})}function k(a){return c.utils.safeNumber(Math.abs(v.y()(a.y+a.y0)-v.y()(a.y0)))}function l(a,b,d){var e=a.selectAll("text.barLabel").data(d.values,c.pluck("x"));e.enter().append("text").attr("class","barLabel").attr("text-anchor","middle"),v.isOrdinal()&&(e.on("click",v.onClick),e.attr("cursor","pointer")),c.transition(e,v.transitionDuration()).attr("x",function(a){var b=v.x()(a.x);return x||(b+=A/2),c.utils.safeNumber(b)}).attr("y",function(a){var b=v.y()(a.y+a.y0);return a.y<0&&(b-=k(a)),c.utils.safeNumber(b-u)}).text(function(a){return v.label()(a)}),c.transition(e.exit(),v.transitionDuration()).attr("height",0).remove()}function m(a,b,d){r=d.values.length;var e=a.selectAll("rect.bar").data(d.values,c.pluck("x")),f=e.enter().append("rect").attr("class","bar").attr("fill",c.pluck("data",v.getColor)).attr("y",v.yAxisHeight()).attr("height",0);v.renderTitle()&&f.append("title").text(c.pluck("data",v.title(d.name))),v.isOrdinal()&&e.on("click",v.onClick),c.transition(e,v.transitionDuration()).attr("x",function(a){var b=v.x()(a.x);return x&&(b-=A/2),v.isOrdinal()&&void 0!==w&&(b+=w/2),c.utils.safeNumber(b)}).attr("y",function(a){var b=v.y()(a.y+a.y0);return a.y<0&&(b-=k(a)),c.utils.safeNumber(b)}).attr("width",A).attr("height",function(a){return k(a)}).attr("fill",c.pluck("data",v.getColor)).select("title").text(c.pluck("data",v.title(d.name))),c.transition(e.exit(),v.transitionDuration()).attr("height",0).remove()}function n(){if(null===v._numberOfBars)var a=v.xUnitCount();else var a=v._numberOfBars;A=v.isOrdinal()&&void 0===w?Math.floor(v.x().rangeBand()):w?Math.floor((v.xAxisLength()-(a-1)*w)/a):Math.floor(v.xAxisLength()/(1+v.barPadding())/a),(A===1/0||isNaN(A)||s>A)&&(A=s)}function o(a){var b=v.x().domain(),c=Math.floor((a-b[0])/(b[1]-b[0])*r);v.accentSelected($("rect.bar",z).get(c))}function p(a){var b=v.x().domain(),c=Math.floor((a-b[0])/(b[1]-b[0])*r);v.unAccentSelected($("rect.bar",z).get(c))}function q(b,c){return function(){var d=a.select(this),e=d.attr("fill")===b;return c?!e:e}}var r,s=1,t=4,u=3,v=c.stackMixin(c.coordinateGridMixin({})),w=t,x=!1,y=!1,z=b;v.accent=o,v.unAccent=p,v._numberOfBars=null;var A;return c.override(v,"rescale",function(){return v._rescale(),A=void 0,v}),v.label(function(a){return c.utils.printSingleValue(a.y0+a.y)},!1),v.plotData=function(){var b=v.chartBodyG().selectAll("g.stack").data(v.data());n(),b.enter().append("g").attr("class",function(a,b){return"stack _"+b});var c=b.size()-1;b.each(function(b,d){var e=a.select(this);m(e,d,b),v.renderLabel()&&c===d&&l(e,d,b)}),v.brushOn()&&e()},v.fadeDeselectedArea=function(){var a=v.chartBodyG().selectAll("rect.bar"),b=v.brush().extent();if(v.isOrdinal())v.hasFilter()?(a.classed(c.constants.SELECTED_CLASS,function(a){return v.hasFilter(a.x)}),a.classed(c.constants.DESELECTED_CLASS,function(a){return!v.hasFilter(a.x)})):(a.classed(c.constants.SELECTED_CLASS,!1),a.classed(c.constants.DESELECTED_CLASS,!1));else if(v.brushIsEmpty(b))a.classed(c.constants.DESELECTED_CLASS,!1);else{var d=b[0],e=b[1];a.classed(c.constants.DESELECTED_CLASS,function(a){return a.x<d||a.x>=e})}},v.centerBar=function(a){return arguments.length?(x=a,v):x},c.override(v,"onClick",function(a){v._onClick(a.data)}),v.barPadding=function(a){return arguments.length?(v._rangeBandPadding(a),w=void 0,v):v._rangeBandPadding()},v._useOuterPadding=function(){return void 0===w},v.outerPadding=v._outerRangeBandPadding,v.gap=function(a){return arguments.length?(w=a,v):w},v.extendBrush=function(){var a=v.brush().extent();return!v.round()||x&&!y||(a[0]=a.map(v.round())[0],a[1]=a.map(v.round())[1],v.chartBodyG().select(".brush").call(v.brush().extent(a))),a},v.alwaysUseRounding=function(a){return arguments.length?(y=a,v):y},v.legendHighlight=function(a){v.isLegendableHidden(a)||v.g().selectAll("rect.bar").classed("highlight",q(a.color)).classed("fadeout",q(a.color,!0))},v.legendReset=function(){v.g().selectAll("rect.bar").classed("highlight",!1).classed("fadeout",!1)},c.override(v,"xAxisMax",function(){var a=this._xAxisMax();if("resolution"in v.xUnits()){var b=v.xUnits().resolution;a+=b}return a}),v.anchor(b,d)},c.lineChart=function(b,d){function e(a,b){return H.getColor.call(a,a.values,b)}function f(b,d){var f=a.svg.line().x(function(a){return H.x()(a.x)}).y(function(a){return I?H.y()(a.y+a.y0):H.y()(a.y)}).interpolate(N).tension(O);z&&f.defined(z);var g=b.append("path").attr("class","line").attr("stroke",e);A&&g.attr("stroke-dasharray",A),c.transition(d.select("path.line"),H.transitionDuration()).attr("stroke",e).attr("d",function(a){return j(f(a.values))})}function g(b,d){if(I){var f=a.svg.area().x(function(a){return H.x()(a.x)}).y(function(a){return H.y()(a.y+a.y0)}).y0(function(a){
return H.y()(a.y0)}).interpolate(N).tension(O);z&&f.defined(z),b.append("path").attr("class","area").attr("fill",e).attr("d",function(a){return j(f(a.values))}),c.transition(d.select("path.area"),H.transitionDuration()).attr("fill",e).attr("d",function(a){return j(f(a.values))})}}function h(a){var b=H.x().domain(),c=(a.getTime()-b[0].getTime())/(b[1].getTime()-b[0].getTime()),d=H.width()-H.margins().left-H.margins().right,e=Math.floor(d*c)+H.margins().left;this.svg().append("line").attr("class","accented").attr("x1",e).attr("y1",0+H.margins().top).attr("x2",e).attr("y2",H.height()-H.margins().bottom)}function i(a){$("line.accented",this.chart).remove()}function j(a){return!a||a.indexOf("NaN")>=0?"M0,0":a}function k(){var a=H.g().on("mouseout",function(){l()}).on("mousemove",function(){H.isBrushing()?o():m(a,this)})}function l(){H.g().selectAll(".dot").style("fill-opacity",0),o()}function m(b,c){var d=[0,0];d=a.mouse(c);var e=d[0],f=d[1],g=e-H.margins().left,h=[];b.selectAll(".dc-tooltip").each(function(){var b=null,c=null,d=a.select(this).selectAll(".dot").style("fill-opacity",0);d[0].sort(function(b,c){return a.select(b).attr("cx")-a.select(c).attr("cx")}),d[0].some(function(d,e){var f=a.select(d);return g<f.attr("cx")?(c={elm:f,datum:f.datum(),i:e},!0):void(b={elm:f,datum:f.datum(),i:e})}),c=b&&c&&Math.abs(b.elm.attr("cx")-g)<Math.abs(c.elm.attr("cx")-g)?b:c,c&&Math.abs(c.elm.attr("cx")-g)<32&&(c.elm.style("fill-opacity",1),h.push(c))});h.length>0?n(h,e,f):o()}function n(b,c,d){var f=a.time.format.utc("%b %d, %Y"),g=a.time.format.utc("%b %d, %Y · %I:%M%p"),h=a.format(","),i=H.popup(),j=i.select(".chart-popup-box").html("").classed("popup-list",!0);j.append("div").attr("class","popup-header").text(function(){var a=Math.round(Math.abs((H.xAxisMin().getTime()-H.xAxisMax().getTime())/864e5));return a>14?f(b[0].datum.x):g(b[0].datum.x)});var k=j.selectAll(".popup-item").data(b.sort(function(a,b){return I?b.datum.y+b.datum.y0-(a.datum.y+a.datum.y0):b.datum.y-a.datum.y})).enter().append("div").attr("class","popup-item");k.append("div").attr("class","popup-legend").style("background-color",function(a){return e(a.datum,a.i)}),k.append("div").attr("class","popup-item-value").text(function(a){return h(parseFloat((I?a.datum.y+a.datum.y0:a.datum.y).toFixed(2)))}),p(c,d),i.classed("js-showPopup",!0)}function o(){H.popup().classed("js-showPopup",!1)}function p(b,c){var d=H.popup().attr("style",function(){return"transform:translate("+b+"px,"+c+"px)"});d.select(".chart-popup-box").classed("align-left-center",!0).classed("align-right-center",function(){return b+(a.select(this).node().getBoundingClientRect().width+32)>H.width()})}function q(b,d){var f=C+"-list",g=b.select("g."+f);g.empty()&&(g=b.append("g").attr("class",f)),d.each(function(b,d){var f=b.values;z&&(f=f.filter(z));var h=g.select("g."+C+"._"+d);h.empty()&&(h=g.append("g").attr("class",C+" _"+d)),r(h);var i=h.selectAll("circle."+D).data(f,c.pluck("x"));i.enter().append("circle").attr("class",D).attr("r",u()).style("fill-opacity",L).style("stroke-opacity",M).on("mousemove",function(){var b=a.select(this);s(b),t(b,h)}).on("mouseout",function(){var b=a.select(this);v(b),w(h)}),i.attr("cx",function(a){return c.utils.safeNumber(H.x()(a.x))}).attr("cy",function(a){return I?c.utils.safeNumber(H.y()(a.y+a.y0)):c.utils.safeNumber(H.y()(a.y))}).attr("fill",e).call(x,b),i.exit().remove()}),H.brushOn()&&!H.focusChart()&&k()}function r(a){var b=a.select("path."+E).empty()?a.append("path").attr("class",E):a.select("path."+E);b.style("display","none").attr("stroke-dasharray","5,5");var c=a.select("path."+F).empty()?a.append("path").attr("class",F):a.select("path."+F);c.style("display","none").attr("stroke-dasharray","5,5")}function s(a){return a.style("fill-opacity",.8),a.style("stroke-opacity",.8),a.attr("r",J),a}function t(a,b){var c=a.attr("cx"),d=a.attr("cy"),e=H._yAxisX()-H.margins().left,f="M"+e+" "+d+"L"+c+" "+d,g="M"+c+" "+H.yAxisHeight()+"L"+c+" "+d;b.select("path."+E).style("display","").attr("d",f),b.select("path."+F).style("display","").attr("d",g)}function u(){return K||J}function v(a){a.style("fill-opacity",L).style("stroke-opacity",M).attr("r",u())}function w(a){a.select("path."+E).style("display","none"),a.select("path."+F).style("display","none")}function x(a,b){H.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(c.pluck("data",H.title(b.name))))}function y(b,c,d){return function(){var e=a.select(this),f=e.attr("stroke")===b&&e.attr("stroke-dasharray")===(c instanceof Array?c.join(","):null)||e.attr("fill")===b;return d?!f:f}}var z,A,B=5,C="dc-tooltip",D="dot",E="yRef",F="xRef",G=1e-6,H=c.stackMixin(c.coordinateGridMixin({})),I=!1,J=B,K=null,L=G,M=G,N="linear",O=.7,P=!0;return H.accent=h,H.unAccent=i,H.transitionDuration(500),H._rangeBandPadding(1),H.plotData=function(){var a=H.chartBodyG(),b=a.selectAll("g.stack-list");b.empty()&&(b=a.append("g").attr("class","stack-list"));var c=b.selectAll("g.stack").data(H.data()),d=c.enter().append("g").attr("class",function(a,b){return"stack _"+b});f(d,c),g(d,c),q(a,c),H.rangeInput()&&H.updateRangeInput()},H.interpolate=function(a){return arguments.length?(N=a,H):N},H.tension=function(a){return arguments.length?(O=a,H):O},H.defined=function(a){return arguments.length?(z=a,H):z},H.dashStyle=function(a){return arguments.length?(A=a,H):A},H.renderArea=function(a){return arguments.length?(I=a,H):I},H.xyTipsOn=function(a){return arguments.length?(P=a,H):P},H.dotRadius=function(a){return arguments.length?(J=a,H):J},H.renderDataPoints=function(a){return arguments.length?(a?(L=a.fillOpacity||.8,M=a.strokeOpacity||.8,K=a.radius||2):(L=G,M=G,K=null),H):{fillOpacity:L,strokeOpacity:M,radius:K}},H.legendHighlight=function(a){H.isLegendableHidden(a)||H.g().selectAll("path.line, path.area").classed("highlight",y(a.color,a.dashstyle)).classed("fadeout",y(a.color,a.dashstyle,!0))},H.legendReset=function(){H.g().selectAll("path.line, path.area").classed("highlight",!1).classed("fadeout",!1)},c.override(H,"legendables",function(){var a=H._legendables();return A?a.map(function(a){return a.dashstyle=A,a}):a}),H.anchor(b,d)},c.dataCount=function(b,d){var e=a.format(",d"),f=c.baseMixin({}),g={some:"",all:""};return f.isCountChart=function(){return!0},f.html=function(a){return arguments.length?(a.all&&(g.all=a.all),a.some&&(g.some=a.some),f):g},f.formatNumber=function(a){return arguments.length?(e=a,f):e},f.setDataAsync(function(a,b){a.valueAsync(b)}),f._doRender=function(){var a=f.dimension().size(),b=null;b=null!=f.dataCache?f.dataCache:f.group().value(),c._lastFilteredSize=b;var d=e(a),h=e(b);return a===b&&""!==g.all?f.root().html(g.all.replace("%total-count",d).replace("%filter-count",h)):""!==g.some?f.root().html(g.some.replace("%total-count",d).replace("%filter-count",h)):(f.selectAll(".total-count").text(d),f.selectAll(".filter-count").classed("dark-text",d!==h).text(h)),f},f._doRedraw=function(){return f._doRender()},f.anchor(b,d)},c.dataTable=function(b,d){function e(){var a=!0;if(p.forEach(function(b){a&="function"==typeof b}),!a){n.selectAll("th").remove(),n.selectAll("thead").remove();var b=(n.root().append("thead"),n.root().selectAll("th").data(p)),c=b.enter().append("th");c.attr("class",m).html(function(a){return n._doColumnHeaderFormat(a)})}var d=n.root().selectAll("tbody").data(f(),function(a){return n.keyAccessor()(a)}),e=d.enter().append("tbody");return t===!0&&e.append("tr").attr("class",l).append("td").attr("class",i).attr("colspan",p.length).html(function(a){return n.keyAccessor()(a)}),d.exit().remove(),n.addFilterIcons(c),e}function f(){var b;return b=null!=n.dataCache?n.dataCache:r===a.ascending?n.dimension().bottom(o):n.dimension().top(o),a.nest().key(n.group()).sortKeys(r).entries(b.sort(function(a,b){return r(q(a),q(b))}).slice(s,h))}function g(a){var b=a.order().selectAll("tr."+j).data(function(a){return a.values}),c=b.enter().append("tr").attr("class",j);return p.forEach(function(a,b){c.append("td").attr("class",k+" _"+b).html(function(a){var c="col"+b;return n._doColumnValueFormat(c,a)})}),b.exit().remove(),b}var h,i="dc-table-label",j="dc-table-row",k="dc-table-column",l="dc-table-group",m="dc-table-head",n=c.baseMixin({}),o=25,p=[],q=function(a){return a},r=a.ascending,s=0,t=!0,u={},v=!1;return n.setDataAsync(function(b,c){r===a.ascending?n.dimension().bottomAsync(o,void 0,void 0,c):n.dimension().topAsync(o,void 0,void 0,c)}),n.sampling=function(a){return arguments.length?(a&&!v?c._sampledCount++:!a&&v&&c._sampledCount--,v=a,0==v&&n.dimension().samplingRatio(null),n):v},n.addFilteredColumn=function(a){u[a]=null},n.removeFilteredColumn=function(a){delete u[a]},n.clearFilteredColumns=function(){u={}},n.getFilteredColumns=function(){return u},n.addFilterIcons=function(a){for(var b=0;b<p.length;b++)p[b]in u&&($("th",a).eq(b).addClass("column-filtered").append('<div class="column-filter-clear" id="table-column-filter-clear_'+b+'" title="Clear filter" style="cursor:pointer"><i class="fa fa-filter"></i><i class="fa fa-times clear-times-icon" style="margin-left:-3px"></i></div>'),$("#table-column-filter-clear_"+b).click(function(){var a=$(this).attr("id").split("_")[1];n.removeFilteredColumn(p[a]),$(n).trigger("column-filter-clear",[a])}))},n.setSample=function(){v&&(null==c._lastFilteredSize?n.dimension().samplingRatio(null):n.dimension().samplingRatio(Math.min(o/c._lastFilteredSize,1)))},n._doRender=function(){return n.selectAll("tbody").remove(),g(e()),n},n._doColumnValueFormat=function(a,b){if("string"==typeof a){if("[object Date]"===Object.prototype.toString.call(b[a])){var c=.001*b[a].getTime();return c%86400==0?moment.utc(b[a]).format("ddd, MMM D YYYY"):moment.utc(b[a]).format("ddd, MMM D YYYY, h:mm:ss a")}return $("<p>"+b[a]+"</p>").linkify().html()}return"function"==typeof a?a(b):a.format(b)},n._doColumnHeaderFormat=function(a){return"function"==typeof a?n._doColumnHeaderFnToString(a):"string"==typeof a?n._covertToAlias(a):String(a.label)},n._covertToAlias=function(a){return"undefined"!=typeof aliases?aliases[a]:a},n._doColumnHeaderCapitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},n._doColumnHeaderFnToString=function(a){var b=String(a),c=b.indexOf("return ");if(c>=0){var d=b.lastIndexOf(";");if(d>=0){b=b.substring(c+7,d);var e=b.indexOf("numberFormat");e>=0&&(b=b.replace("numberFormat",""))}}return b},n._doRedraw=function(){return n._doRender()},n.size=function(a){return arguments.length?(o=a,n):o},n.beginSlice=function(a){return arguments.length?(s=a,n):s},n.endSlice=function(a){return arguments.length?(h=a,n):h},n.columns=function(a){return arguments.length?(p=a,n):p},n.sortBy=function(a){return arguments.length?(q=a,n):q},n.order=function(a){return arguments.length?(r=a,n):r},n.showGroups=function(a){return arguments.length?(t=a,n):t},n.anchor(b,d)},c.mapdTable=function(b,d){function e(){var b=i.data(),d=i.tableWrapper().select("table").html("");if(0!==b.length){var e=[];for(var h in b[0])b[0].hasOwnProperty(h)&&h.indexOf("col")>=0&&e.push(h);var k=d.append("tr").selectAll("th").data(e).enter();k.append("th").text(function(a,b){return n[b]});var l=d.selectAll(".table-row").data(b).enter(),p=l.append("tr");e.forEach(function(b,c){p.append("td").text(function(a){return a[b]}).attr("data-index",c).on("click",function(c){var d=parseInt(a.select(this).attr("data-index"));f(n[d],c[b],typeof c[b],d)}).classed("filtered",function(){return n[c]in o})});var q=i.tableWrapper().select(".md-table-header").html("").append("div").attr("class","docked-table-header").style("left",function(){return"-"+j.select(".md-table-scroll").node().scrollLeft+"px"});i.tableWrapper().select(".md-table-scroll").on("scroll",function(){q.style("left","-"+a.select(this).node().scrollLeft+"px");var b=a.select(this).node().scrollTop+a.select(this).node().getBoundingClientRect().height;!m&&d.node().scrollHeight<=b+b/5&&i.addRows()}),d.selectAll("th").each(function(b,d){var e=q.append("div").attr("class","table-header-item").classed("isFiltered",function(){return n[d]in o}),f=e.append("div").attr("class","table-sort").classed("active",r?r.index===d:!1).classed(r?r.order:"",!0).on("click",function(){j.selectAll(".table-sort").classed("active asc desc",!1),r=r&&r.index===d?"desc"===r.order?{index:d,col:b,order:"asc"}:null:{index:d,col:b,order:"desc"},c.redrawAll()}).style("width",a.select(this).node().getBoundingClientRect().width+"px"),h=f.append("span").text(n[d]),k=f.append("div").attr("class","sort-btn");k.append("svg").attr("class","svg-icon").classed("icon-sort",!0).attr("viewBox","0 0 48 48").append("use").attr("xlink:href","#icon-sort"),k.append("svg").attr("class","svg-icon").classed("icon-sort-arrow",!0).attr("viewBox","0 0 48 48").append("use").attr("xlink:href","#icon-arrow1");e.append("div").attr("class","unfilter-btn").attr("data-index",d).on("click",function(){var b=parseInt(a.select(this).attr("data-index"));i.removeFilteredColumn(n[b]),g(b)}).style("left",h.node().getBoundingClientRect().width+20+"px").append("svg").attr("class","svg-icon").classed("icon-unfilter",!0).attr("viewBox","0 0 48 48").append("use").attr("xlink:href","#icon-unfilter")})}}function f(b,d,e,f){var g=d,j=a.time.format.utc("%Y-%m-%d");a.time.format.utc("%Y-%m-%d %H:%M:%S");"[object Date]"===Object.prototype.toString.call(g)?g="DATE '"+j(g)+"'":"string"===e&&null!==g&&(g="'"+g.replace(/'/g,"''")+"'"),i.addFilteredColumn(b),p[b]=g,q.filter(h(p)),c.redrawAll()}function g(a){var b=n[a];delete p[b],q.filter(h(p)),c.redrawAll()}function h(a){var b="",c=null;for(var d in a)c="null"===a[d]?d+" IS null":d+" = "+a[d],b+=""==b?c:" AND "+c;return b}var i=c.baseMixin({}),j=null,k=25,l=0,m=!1,n=[],o={},p={},q=null,r=null;i.columnFilterMap=function(a){return arguments.length?(p=a,i):p},i.tableFilter=function(a){return arguments.length?(q=a,i):q},i.sortColumn=function(a){return arguments.length?(r=a,i):r},i.tableWrapper=function(a){return arguments.length?(j=a,i):j};var s=function(a){i.dataCache=i.dataCache.concat(a),i._doRedraw(),m=!1};return i.addRows=function(){l+=k,i.dimension().topAsync(k,l,void 0,[s]),m=!0},i.data(function(){return i.dataCache||(i.dataCache=r?"desc"===r.order?i.dimension().order(r.col).top(k+l,0):i.dimension().order(r.col).bottom(k+l,0):i.dimension().order(null).top(k+l,0)),i.dataCache}),i.setDataAsync(function(a,b){l=0,r?"desc"===r.order?i.dimension().order(r.col).topAsync(k,l,void 0,b):i.dimension().order(r.col).bottomAsync(k,l,void 0,b):i.dimension().order(null).topAsync(k,l,void 0,b),j.select(".md-table-scroll").node().scrollTop=0}),i.addFilteredColumn=function(a){o[a]=null},i.removeFilteredColumn=function(a){delete o[a]},i.clearFilteredColumns=function(){o={}},i.getFilteredColumns=function(){return o},i.clearTableFilter=function(){p={},i.clearFilteredColumns(),q.filter()},i._doRender=function(){return j||(j=i.root().append("div").attr("class","md-table-wrapper"),j.append("div").attr("class","md-header-spacer"),j.append("div").attr("class","md-table-scroll").append("table"),j.append("div").attr("class","md-table-header")),m=!1,e(),i},i._doRedraw=function(){return i._doRender()},i.size=function(a){return arguments.length?(k=a,i):k},i.columns=function(a){return arguments.length?(n=a,i):n},i.order=function(a){return arguments.length?(_order=a,i):_order},i.anchor(b,d)},c.dataGrid=function(b,d){function e(){var a=m.root().selectAll("div."+l).data(f(),function(a){return m.keyAccessor()(a)}),b=a.enter().append("div").attr("class",l);return s&&b.html(function(a){return s(a)}),a.exit().remove(),b}function f(){var b=m.dimension().top(n);return a.nest().key(m.group()).sortKeys(q).entries(b.sort(function(a,b){return q(p(a),p(b))}).slice(r,h))}function g(a){var b=a.order().selectAll("div."+j).data(function(a){return a.values});return b.enter().append("div").attr("class",j).html(function(a){return o(a)}),b.exit().remove(),b}var h,i="dc-grid-label",j="dc-grid-item",k="dc-grid-group",l="dc-grid-top",m=c.baseMixin({}),n=999,o=function(a){return"you need to provide an html() handling param:  "+JSON.stringify(a)},p=function(a){return a},q=a.ascending,r=0,s=function(a){return"<div class='"+k+"'><h1 class='"+i+"'>"+m.keyAccessor()(a)+"</h1></div>"};return m._doRender=function(){return m.selectAll("div."+l).remove(),g(e()),m},m._doRedraw=function(){return m._doRender()},m.beginSlice=function(a){return arguments.length?(r=a,m):r},m.endSlice=function(a){return arguments.length?(h=a,m):h},m.size=function(a){return arguments.length?(n=a,m):n},m.html=function(a){return arguments.length?(o=a,m):o},m.htmlGroup=function(a){return arguments.length?(s=a,m):s},m.sortBy=function(a){return arguments.length?(p=a,m):p},m.order=function(a){return arguments.length?(q=a,m):q},m.anchor(b,d)},c.bubbleChart=function(b,d){function e(a,b){var c=Math.sqrt((a.xPixel-b.xPixel)*(a.xPixel-b.xPixel)+(a.yPixel-b.yPixel)*(a.yPixel-b.yPixel));return a.radius+8>=c}function f(b){for(var c=a.format(".2s"),d='<td><div class="table-dim"><div class="table-legend" style="background:'+n.getColor(b)+'"></div><div class="table-dim-val">'+b.key0+"</div></div></td>",e=1;e<o.length;e++)o[e].alias&&(d+="<td>"+c(b[o[e].alias])+"</td>");return d}function g(b,c){var d=l(b)+n.margins().left,e=m(b)+n.margins().top,f=n.popup().attr("style",function(){var b=a.select(this).select(".chart-popup-box").node().getBoundingClientRect().width/2,c=0>d-b?b-d-16:d+b>n.width()?n.width()-(d+b)+16:0;return a.select(this).select(".popup-bridge").style("left",function(){return 0!==c?b-c+"px":"50%"}),"transform:translate("+(d+c)+"px,"+e+"px)"});f.select(".chart-popup-box").classed("align-center",!0).classed("popdown",function(){return f.node().getBoundingClientRect().top-76<a.select(this).node().getBoundingClientRect().height?!0:!1}).select(".popup-table-wrap").style("overflow-y",function(){return f.select(".popup-table").node().getBoundingClientRect().height>160?"scroll":"hidden"})}function h(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function i(a){var b=a.enter().append("g"),d=h(function(a,b){n.showPopup(a,b)},250);b.attr("class",n.BUBBLE_NODE_CLASS).attr("transform",s).on("mouseover",function(a,b){JSON.stringify(p)!==JSON.stringify(a)&&(d(a,b),n.hidePopup())}).append("circle").attr("class",function(a,b){return n.BUBBLE_CLASS+" _"+b}).on("click",n.onClick).attr("fill",n.getColor).attr("r",0),c.transition(a,n.transitionDuration()).selectAll("circle."+n.BUBBLE_CLASS).attr("r",function(a){return n.bubbleR(a)}).attr("opacity",function(a){return n.bubbleR(a)>0?1:0}),n._doRenderLabel(b)}function j(a){c.transition(a,n.transitionDuration()).attr("transform",s).select("circle."+n.BUBBLE_CLASS).attr("fill",n.getColor).attr("r",function(a){return n.bubbleR(a)}).attr("opacity",function(a){return n.bubbleR(a)>0?1:0}),n.doUpdateLabels(a),n.doUpdateTitles(a)}function k(a){a.exit().remove()}function l(a){var b=n.x()(n.keyAccessor()(a));return isNaN(b)&&(b=0),b}function m(a){var b=n.y()(n.valueAccessor()(a));return isNaN(b)&&(b=0),b}var n=c.bubbleMixin(c.capMixin(c.coordinateGridMixin({}))),o=[],p=null,q=!1,r=!1;n.transitionDuration(750);var s=function(a){return"translate("+l(a)+","+m(a)+")"};return n.setPopupHeader=function(a){return arguments.length?(o=a,n):o},n.hideOverlappedLabels=function(){var b=n.svg().selectAll(".node"),c=10,d=5;b[0].reverse(),b.classed("hide-label",function(a){return n.bubbleR(a)<n.minRadiusWithLabel()}).each(function(e,f){var g=this,h=(f>0?e.radius:n.bubbleR(e),f>0?e.xPixel:l(e)),i=f>0?e.yPixel:m(e),j=e.key0;if(!a.select(g).classed("hide-label"))for(var k=f+1;k<b[0].length;k++){var o=a.select(b[0][k]),e=o.datum(),p=e.xPixel=l(e),q=e.yPixel=m(e),r=e.radius=n.bubbleR(e),s=e.key0;if(!(Math.abs(i-q)>c||r<n.minRadiusWithLabel()||o.classed("hide-label"))){var t=h-(j+"").length*d/2,u=h+(j+"").length*d/2,v=p-(s+"").length*d/2,w=p+(s+"").length*d/2,x=t>=v&&w>=t||u>=v&&w>=u||v>=t&&u>=w;x&&o.classed("hide-label",!0)}}})},n.showPopup=function(b,c){n.svg().select(".mouse-out-detect").empty()&&n.svg().insert("rect",":first-child").attr("class","mouse-out-detect").attr({width:n.width(),height:n.height()}).on("mousemove",n.hidePopup),p=b;var d=n.popup(),h=d.select(".chart-popup-box").html("");h.append("div").attr("class","popup-bridge").style("width",2*n.bubbleR(b)+"px").style("height",n.bubbleR(b)+24+"px");var i=h.append("div").attr("class","popup-table-wrap").on("mouseleave",n.hidePopup),j=i.append("table").attr("class","popup-table"),k=j.append("tr"),l=k.selectAll("th").data(o).enter().append("th");l.append("div").attr("class","ellipse-text").text(function(a){return a.label}).append("div").attr("class","full-text").text(function(a){return a.label}).on("mouseenter",function(){a.select(this).style("transform",function(){var b=a.select(this),c=b.node().getBoundingClientRect().width,d=b.node().parentNode.getBoundingClientRect().width;if(d>c)return b.classed("scroll-text",!1),"none";var e=c-d;return b.style("transition-duration",.05*e+"s").classed("scroll-text",!0).on("webkitTransitionEnd",function(){setTimeout(function(){b.classed("scroll-text",!1).style("transform","translateX(0)")},500),setTimeout(function(){b.style("transform","translateX("+-e+"px)").classed("scroll-text",!0)},1e3)}),"translateX("+-e+"px)"})}).on("mouseleave",function(){a.select(this).classed("scroll-text",!1).style("transform","translateX(0)")});var m=[b],q=n.svg().selectAll(".node"),r=!1;q[0].reverse(),q.each(function(a,c){return b===a?void(r=!0):void(r&&e(b,a)&&m.push(a))});j.selectAll(".popup-row-item").data(m).enter().append("tr").html(function(a){return f(a)}).on("click",function(a){n.onClick(a)}).attr("class","popup-row-item");n.updatePopup(),d.classed("js-showPopup popup-scrollable",!0),g(b,this)},n.updatePopup=function(){n.hasFilter()?n.popup().selectAll(".popup-row-item").each(function(b){a.select(this).classed("deselected",!n.isSelectedNode(b)).classed("selected",n.isSelectedNode(b))}):n.popup().selectAll(".popup-row-item").classed("deselected",!1).classed("selected",!1)},n.hidePopup=function(){n.popup().classed("js-showPopup",!1),a.select("#charts-container").style("z-index","auto"),p=null},n.elasticRadius=function(a){return arguments.length?(q=a,n):q},n.sortBubbleSize=function(a){return arguments.length?(r=a,n):r},n.plotData=function(){q&&n.r().domain([n.rMin(),n.rMax()]),n.r().range([n.MIN_RADIUS,n.xAxisLength()*n.maxBubbleRelativeSize()]);var b=n.data();if(r){var c=n.radiusValueAccessor();b.sort(function(b,d){return a.descending(c(b),c(d))})}var d=n.chartBodyG().selectAll("g."+n.BUBBLE_NODE_CLASS).data(n.data(),function(a){return a.key0});r&&d.order(),i(d),j(d),k(d),n.fadeDeselectedArea()},n.renderBrush=function(){},n.redrawBrush=function(){n.fadeDeselectedArea()},n.anchor(b,d)},c.compositeChart=function(b,d){function e(a,b){var c,d,e,f;if(a&&(c=l(),d=o()),b&&(e=m(),f=p()),v.alignYAxes()&&a&&b&&(0>c||0>e)){var g,h;0>c&&(g=d/c),0>e&&(h=f/e),0>c&&0>e?h>g?f=e*g:d=c*h:0>c?e=f/g:c=d/(f/e)}return{lyAxisMin:c,lyAxisMax:d,ryAxisMin:e,ryAxisMax:f}}function f(b){(void 0===v.rightY()||v.elasticY()||v.resizing())&&(void 0===v.rightY()&&v.rightY(a.scale.linear()),v.rightY().domain([b.ryAxisMin,b.ryAxisMax]).rangeRound([v.yAxisHeight(),0])),v.rightY().range([v.yAxisHeight(),0]),v.rightYAxis(v.rightYAxis().scale(v.rightY())),v.rightYAxis().orient("right")}function g(b){(void 0===v.y()||v.elasticY()||v.resizing())&&(void 0===v.y()&&v.y(a.scale.linear()),v.y().domain([b.lyAxisMin,b.lyAxisMax]).rangeRound([v.yAxisHeight(),0])),v.y().range([v.yAxisHeight(),0]),v.yAxis(v.yAxis().scale(v.y())),v.yAxis().orient("left")}function h(a,b){a._generateG(v.g()),a.g().attr("class",t+" _"+b)}function i(){return w.filter(function(a){return!a.useRightYAxis()})}function j(){return w.filter(function(a){return a.useRightYAxis()})}function k(a){return a.map(function(a){return a.yAxisMin()})}function l(){return a.min(k(i()))}function m(){return a.min(k(j()))}function n(a){return a.map(function(a){return a.yAxisMax()})}function o(){return c.utils.add(a.max(n(i())),v.yAxisPadding())}function p(){return c.utils.add(a.max(n(j())),v.yAxisPadding())}function q(){return w.map(function(a){return a.xAxisMin()})}function r(){return w.map(function(a){return a.xAxisMax()})}var s,t="sub",u=12,v=c.coordinateGridMixin({}),w=[],x={},y=!1,z=!0,A=!1,B=a.svg.axis(),C=0,D=u,E=!1;return v._mandatoryAttributes([]),v.transitionDuration(500),c.override(v,"_generateG",function(){for(var a=this.__generateG(),b=0;b<w.length;++b){var c=w[b];h(c,b),c.dimension()||c.dimension(v.dimension()),c.group()||c.group(v.group()),c.chartGroup(v.chartGroup()),c.svg(v.svg()),c.xUnits(v.xUnits()),c.transitionDuration(v.transitionDuration()),c.brushOn(v.brushOn()),c.renderTitle(v.renderTitle()),c.elasticX(v.elasticX())}return a}),v._brushing=function(){for(var a=v.extendBrush(),b=v.brushIsEmpty(a),c=0;c<w.length;++c)w[c].filter(null),b||w[c].filter(a)},v._prepareYAxis=function(){var a=0!==i().length,b=0!==j().length,c=e(a,b);a&&g(c),b&&f(c),i().length>0&&!E?v._renderHorizontalGridLinesForAxis(v.g(),v.y(),v.yAxis()):j().length>0&&v._renderHorizontalGridLinesForAxis(v.g(),s,B)},v.renderYAxis=function(){0!==i().length&&(v.renderYAxisAt("y",v.yAxis(),v.margins().left),v.renderYAxisLabel("y",v.yAxisLabel(),-90)),0!==j().length&&(v.renderYAxisAt("yr",v.rightYAxis(),v.width()-v.margins().right),v.renderYAxisLabel("yr",v.rightYAxisLabel(),90,v.width()-D))},v.plotData=function(){for(var a=0;a<w.length;++a){var b=w[a];b.g()||h(b,a),y&&b.colors(v.colors()),b.x(v.x()),b.xAxis(v.xAxis()),b.useRightYAxis()?(b.y(v.rightY()),b.yAxis(v.rightYAxis())):(b.y(v.y()),b.yAxis(v.yAxis())),b.plotData(),b._activateRenderlets()}},v.useRightAxisGridLines=function(a){return arguments?(E=a,v):E},v.childOptions=function(a){return arguments.length?(x=a,w.forEach(function(a){a.options(x)}),v):x},v.fadeDeselectedArea=function(){for(var a=0;a<w.length;++a){var b=w[a];b.brush(v.brush()),b.fadeDeselectedArea()}},v.rightYAxisLabel=function(a,b){return arguments.length?(C=a,v.margins().right-=D,D=void 0===b?u:b,v.margins().right+=D,v):C},v.compose=function(a){return w=a,w.forEach(function(a){a.height(v.height()),a.width(v.width()),a.margins(v.margins()),z&&a.title(v.title()),a.options(x)}),v},v.children=function(){return w},v.shareColors=function(a){return arguments.length?(y=a,v):y},v.shareTitle=function(a){return arguments.length?(z=a,v):z},v.rightY=function(a){return arguments.length?(s=a,v.rescale(),v):s},v.alignYAxes=function(a){return arguments.length?(A=a,v.rescale(),v):A},delete v.yAxisMin,delete v.yAxisMax,c.override(v,"xAxisMin",function(){return c.utils.subtract(a.min(q()),v.xAxisPadding())}),c.override(v,"xAxisMax",function(){return c.utils.add(a.max(r()),v.xAxisPadding())}),v.legendables=function(){return w.reduce(function(a,b){return y&&b.colors(v.colors()),a.push.apply(a,b.legendables()),a},[])},v.legendHighlight=function(a){for(var b=0;b<w.length;++b){var c=w[b];c.legendHighlight(a)}},v.legendReset=function(a){for(var b=0;b<w.length;++b){var c=w[b];c.legendReset(a)}},v.legendToggle=function(){console.log("composite should not be getting legendToggle itself")},v.rightYAxis=function(a){return arguments.length?(B=a,v):B},v.anchor(b,d)},c.seriesChart=function(b,d){function e(b,c){return a.ascending(i.keyAccessor()(b),i.keyAccessor()(c))}function f(a){j[a].g()&&j[a].g().remove(),delete j[a]}function g(){Object.keys(j).map(f),j={}}var h,i=c.compositeChart(b,d),j={},k=c.lineChart,l=a.ascending,m=e;return i._mandatoryAttributes().push("seriesAccessor","chart"),i.shareColors(!0),i._preprocessData=function(){var b,c=[],e=a.nest().key(h);l&&e.sortKeys(l),m&&e.sortValues(m);var g=e.entries(i.data()),n=g.map(function(e,f){var g=j[e.key]||k.call(i,i,d,e.key,f);return j[e.key]||(b=!0),j[e.key]=g,c.push(e.key),g.dimension(i.dimension()).group({all:a.functor(e.values)},e.key).keyAccessor(i.keyAccessor()).valueAccessor(i.valueAccessor()).brushOn(i.brushOn())});Object.keys(j).filter(function(a){return-1===c.indexOf(a)}).forEach(function(a){f(a),b=!0}),i._compose(n),b&&i.legend()&&i.legend().render()},i.chart=function(a){return arguments.length?(k=a,g(),i):k},i.seriesAccessor=function(a){return arguments.length?(h=a,g(),i):h},i.seriesSort=function(a){return arguments.length?(l=a,g(),i):l},i.valueSort=function(a){return arguments.length?(m=a,g(),i):m},i._compose=i.compose,delete i.compose,i},c.geoChoroplethChart=function(b,d){function e(a){var b=f();if(g(a)){var c=h(a);p(c,a,b)}}function f(){for(var a={},b=t.data(),c=0;c<b.length;++c)a[t.keyAccessor()(b[c])]=t.valueAccessor()(b[c]);return a}function g(a){return o(a).keyAccessor}function h(a){var b=t.svg().selectAll(i(a)).classed("selected",function(b){return l(a,b)}).classed("deselected",function(b){return m(a,b)}).attr("class",function(b){var d=o(a).name,e=c.utils.nameToId(o(a).keyAccessor(b)),f=d+" "+e;return l(a,b)&&(f+=" selected"),m(a,b)&&(f+=" deselected"),f});return b}function i(a){return"g.layer"+a+" g."+o(a).name}function j(a){var b=o(0).name;t.selectAll("g."+b).each(function(b){n(0,b)==a&&t.accentSelected(this)})}function k(a){var b=o(0).name;t.selectAll("g."+b).each(function(b){n(0,b)==a&&t.unAccentSelected(this)})}function l(a,b){return t.hasFilter()&&t.hasFilter(n(a,b))}function m(a,b){return t.hasFilter()&&!t.hasFilter(n(a,b))}function n(a,b){return o(a).keyAccessor(b)}function o(a){return x[a]}function p(b,d,e){var f=b.select("path").attr("fill",function(){var b=a.select(this).attr("fill");return b?b:"#e2e2e2"}).on("mouseenter",function(a,b){q(a,b,e)}).on("mousemove",s).on("mouseleave",r).on("click",function(a){return t.onClick(a,d)});c.transition(f,t.transitionDuration()).attr("fill",function(a,b){return t.getColor(e[o(d).keyAccessor(a)],b)||"#e2e2e2"})}function q(a,b,c){var d=t.popup(),e=d.select(".chart-popup-box").html("");e.append("div").attr("class","popup-legend").style("background-color",t.getColor(c[o(0).keyAccessor(a)],b)),e.append("div").attr("class","popup-value").html(function(){var b=n(0,a),d=isNaN(c[b])?"N/A":Number(c[b]).toFixed(2);return'<div class="popup-value-dim">'+b+'</div><div class="popup-value-measure">'+d+"</div>"}),d.classed("js-showPopup",!0)}function r(){t.popup().classed("js-showPopup",!1)}function s(){var b=[0,0];b=a.mouse(this);var c=b[0],d=b[1]-16,e=t.popup().attr("style",function(){return"transform:translate("+c+"px,"+d+"px)"});e.select(".chart-popup-box").classed("align-right",function(){return c+a.select(this).node().getBoundingClientRect().width>t.width()})}var t=c.colorMixin(c.baseMixin({}));t.colorAccessor(function(a){return a||0}),t.accent=j,t.unAccent=k;var u,v=!1,w=a.geo.path(),x=[];return t._doRender=function(){t.resetSvg();for(var a=0;a<x.length;++a){var b=t.svg().append("g").attr("class","layer"+a).attr("transform","translate(0, -16)"),c=b.selectAll("g."+o(a).name).data(o(a).data).enter().append("g").attr("class",o(a).name);c.append("path").attr("fill","white").attr("d",w),c.append("title"),e(a)}u=!1,v=!0},t.onClick=function(a,b){var d=o(b).keyAccessor(a);c.events.trigger(function(){t.filter(d),t.redrawGroup()})},t._doRedraw=function(){if(!v)return t._doRender();for(var a=0;a<x.length;++a)e(a),u&&t.svg().selectAll("g."+o(a).name+" path").attr("d",w);u=!1},t.overlayGeoJson=function(a,b,c){for(var d=0;d<x.length;++d)if(x[d].name===b)return x[d].data=a,x[d].keyAccessor=c,t;return x.push({name:b,data:a,keyAccessor:c}),t},t.projection=function(a){return w.projection(a),u=!0,t},t.geoJsons=function(){return x},t.geoPath=function(){return w},t.removeGeoJson=function(a){for(var b=[],c=0;c<x.length;++c){var d=x[c];d.name!==a&&b.push(d)}return x=b,t},t.anchor(b,d)},c.bubbleOverlay=function(b,d){function e(a){var b=[0,0];return b[0]=111319.49077777778*a[0],b[1]=6378136.999112157*Math.log(Math.tan(.00872664625997*(90+a[1]))),b}function f(){return j=m.select("g."+k),j.empty()&&(j=m.svg().append("g").attr("class",k)),j}function g(a){if(null!=m.bounds)for(var b=1/(m.bounds[1][0]-m.bounds[0][0])*m.width(),c=1/(m.bounds[1][1]-m.bounds[0][1])*m.height(),d=a.length,f=0;d>f;f++){var g=e([a[f].x,a[f].y]),h=(g[0]-m.bounds[0][0])*b,i=m.height()-(g[1]-m.bounds[0][1])*c;
a[f].xPixel=h,a[f].yPixel=i,a[f].xCoord=g[0],a[f].yCoord=g[1]}}function h(){return m.colorCountDictionary={},m.savedData=m.data(),m.savedData.forEach(function(a){a.color in m.colorCountDictionary?m.colorCountDictionary[a.color]++:m.colorCountDictionary[a.color]=1,a.key=m.keyAccessor()(a)}),null!=o&&o(m.colorCountDictionary),m.savedData}function i(){if(j){var a=j.selectAll("g."+l).data(m.savedData,function(a){return a.key0});a.attr("transform",function(a){return"translate("+a.xPixel+","+a.yPixel+")"})}}var j,k="bubble-overlay",l="node",m=c.bubbleMixin(c.capMixin(c.baseMixin({}))),n=[],o=null,p=null,q=!1;return m.MIN_RADIUS=2,m.MAX_RADIUS=10,m.scaleRadius=!1,m.colorCountDictionary={},m.clickCallback=function(a){return arguments.length?(p=a,m):p},m.transitionDuration(0),m.radiusValueAccessor(function(a){return a.value}),m.r(a.scale.sqrt()),m.bounds=null,m.savedData=[],m.onColorCountUpdate=function(a){return arguments.length?(o=a,m):o},m.sampling=function(a){return arguments.length?(a&&!q?c._sampledCount++:!a&&q&&c._sampledCount--,q=a,0==q&&m.dimension().samplingRatio(null),m):q},m.setSample=function(){q&&(null==c._lastFilteredSize?m.dimension().samplingRatio(null):m.dimension().samplingRatio(Math.min(m.cap()/c._lastFilteredSize,1)))},m.onClick=function(a){if(null!=m.bounds){var b=1/(m.bounds[1][0]-m.bounds[0][0])*m.width(),c=1/(m.bounds[1][1]-m.bounds[0][1])*m.height(),d=e([a.x,a.y]);({x:(d[0]-m.bounds[0][0])*b,y:m.height()-(d[1]-m.bounds[0][1])*c});null!=p&&p(a)}},m.point=function(a,b,c){return n.push({name:a,x:b,y:c}),m},m.setBounds=function(a){m.bounds=[[0,0],[0,0]],m.bounds[0]=e(a[0]),m.bounds[1]=e(a[1])},m._doRender=function(){return j=f(),j.selectAll("g").remove(),m.plotData(),m.fadeDeselectedArea(),m},m.remapPoints=function(){if(null!=m.bounds){for(var a=1/(m.bounds[1][0]-m.bounds[0][0])*m.width(),b=1/(m.bounds[1][1]-m.bounds[0][1])*m.height(),c=m.savedData.length,d=0;c>d;d++)m.savedData[d].xPixel=(m.savedData[d].xCoord-m.bounds[0][0])*a,m.savedData[d].yPixel=m.height()-(m.savedData[d].yCoord-m.bounds[0][1])*b;i()}},m.plotData=function(){h();new Date;g(m.savedData),m.scaleRadius&&(m.r().domain([m.rMin(),m.rMax()]),m.r().range([m.MIN_RADIUS,m.MAX_RADIUS])),j||f();var a=j.selectAll("g."+l).data(m.savedData,function(a){return a.key});a.enter().append("g").attr("class",function(a){return l+" "+c.utils.nameToId(a.key)}).attr("transform",function(a){return"translate("+a.xPixel+","+a.yPixel+")"}).append("circle").attr("class",m.BUBBLE_CLASS).attr("r",function(a){return m.scaleRadius?m.bubbleR(a):m.radiusValueAccessor()(a)}).attr("fill",m.getColor).on("click",m.onClick),a.attr("transform",function(a){return"translate("+a.xPixel+","+a.yPixel+")"}).attr("r",function(a){return m.scaleRadius?m.bubbleR(a):m.radiusValueAccessor()(a)}),a.exit().remove();new Date},m._doRedraw=function(){return m.plotData(),m.fadeDeselectedArea(),m},m.debug=function(b){if(b){var d=m.select("g."+c.constants.DEBUG_GROUP_CLASS);d.empty()&&(d=m.svg().append("g").attr("class",c.constants.DEBUG_GROUP_CLASS));var e=d.append("text").attr("x",10).attr("y",20);d.append("rect").attr("width",m.width()).attr("height",m.height()).on("mousemove",function(){var b=a.mouse(d.node()),c=b[0]+", "+b[1];e.text(c)})}else m.selectAll(".debug").remove();return m},m.anchor(b,d),m},c.rowChart=function(b,d){function e(){if(!y||z){var b=a.extent(A,O.cappedValueAccessor);b[0]>0&&(b[0]=0),y=a.scale.linear().domain(b).range([0,O.effectiveWidth()])}P.scale(y)}function f(){var a=O.root(),b=a.select("g.axis");e(),b.empty()&&(b=O.autoScroll()?a.append("div").attr("class","external-axis").append("svg").attr("height",32).append("g").attr("class","axis").attr("transform","translate("+O.margins().left+", 0)"):v.append("g").attr("class","axis").attr("transform","translate(0, "+O.effectiveHeight()+")")),O.autoScroll()&&a.select(".external-axis svg").attr("width",O.width());var d=a.selectAll(".y-axis-label");d.empty()&&(d=a.append("div").attr("class","y-axis-label").text("undefined"!=typeof aliases?aliases[x]:x)),d.style("top",O.effectiveHeight()/2+O.margins().top+"px");var f=a.selectAll(".x-axis-label");f.empty()&&(f=a.append("div").attr("class","x-axis-label").text(O.xAxisLabel())),f.style("left",O.effectiveWidth()/2+O.margins().left+"px"),c.transition(b,O.transitionDuration()).call(P)}function g(){v.selectAll("g.tick").select("line.grid-line").remove(),v.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-O.effectiveHeight()})}function h(){A=O.data(),f(),g();var a=v.selectAll("g."+L).data(A);i(a),j(a),l(a)}function i(a){var b=a.enter().append("g").attr("class",function(a,b){return L+" _"+b});b.append("rect").attr("width",0),n(b),o(a)}function j(a){a.exit().remove()}function k(){var a=y(0);return a===-(1/0)||a!==a?y(1):a}function l(a){var b,d=A.length;b=K?K:(O.effectiveHeight()-J-(d+1)*J)/d,I=2*C>(O.measureLabelsOn()?64:32),I&&(b=(O.effectiveHeight()-J-(d+1)*J)/d),O.autoScroll()&&H>b&&(b=H,O.root().select(".svg-wrapper").style("height",O.height()-52+"px").style("overflow-y","auto").style("overflow-x","hidden"),O.svg().attr("height",d*(b+J)+8)),D||(C=b/2);var e=a.attr("transform",function(a,c){return"translate(0,"+((c+1)*J+c*b)+")"}).select("rect").attr("height",b).attr("fill",O.getColor).on("click",p).classed("deselected",function(a){return O.hasFilter()?!u(a):!1}).classed("selected",function(a){return O.hasFilter()?u(a):!1});c.transition(e,O.transitionDuration()).attr("width",function(a){return Math.abs(k()-y(O.valueAccessor()(a)))}).attr("transform",r),O.measureLabelsOn()||m(a),o(a)}function m(a){O.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(O.title()))}function n(a){O.renderLabel()&&a.append("text").on("click",p),O.measureLabelsOn()&&a.append("text").attr("class","value-measure").on("click",p),O.renderTitleLabel()&&a.append("text").attr("class",M).on("click",p)}function o(b){if(b.selectAll("text").style("font-size",I?"14px":"12px"),O.renderLabel()){var d=b.select("text").attr("x",B).attr("y",C).attr("dy",E).attr("dy",q()?"-0.25em":E).on("click",p).attr("class",function(a,b){return L+" _"+b}).classed("value-dim",!0).text(function(a){return O.label()(a)});c.transition(d,O.transitionDuration()).attr("transform",r)}if(O.measureLabelsOn()){var e=a.format(","),f=b.select(".value-measure").attr("y",C).attr("dy",q()?"1.1em":E).on("click",p).attr("text-anchor",q()?"start":"end").text(function(a){return e(O.measureValue(a))}).attr("x",function(b,c){if(q())return B+1;var d=a.select(this),e=Math.abs(k()-y(O.valueAccessor()(b))),f=d.node().getBBox().width,g=O.svg().select("text.value-dim._"+c).node().getBBox().width,h=f+g+16;return d.attr("text-anchor",q()||h>e?"start":"end"),e>h?e-4:g+16});c.transition(f,O.transitionDuration()).attr("transform",r)}if(O.renderTitleLabel()){var g=b.select("."+M).attr("x",O.effectiveWidth()-F).attr("y",C).attr("text-anchor","end").on("click",p).attr("class",function(a,b){return M+" _"+b}).text(function(a){return O.title()(a)});c.transition(g,O.transitionDuration()).attr("transform",r)}}function p(a){O.onClick(a)}function q(){return O.measureLabelsOn()&&C>16}function r(a){var b=y(O.cappedValueAccessor(a)),c=k(),d=b>c?c:b;return"translate("+d+",0)"}function s(a){O.selectAll("g."+L).each(function(b){O.cappedKeyAccessor(b)==a&&O.accentSelected(this)})}function t(a){O.selectAll("g."+L).each(function(b){O.cappedKeyAccessor(b)==a&&O.unAccentSelected(this)})}function u(a){return O.hasFilter(O.cappedKeyAccessor(a))}var v,w,x,y,z,A,B=8,C=16,D=!1,E="0.35em",F=2,G=!1,H=16,I=!1,J=4,K=!1,L="row",M="titlerow",N=!1,O=c.capMixin(c.marginMixin(c.colorMixin(c.baseMixin({})))),P=a.svg.axis().orient("bottom");return O.rowsCap=O.cap,O.accent=s,O.unAccent=t,O.setYAxisLabel=function(a){x=a},O.xAxisLabel=function(a,b){return arguments.length?(w=a,O):w},O._doRender=function(){return O.resetSvg(),v=O.svg().append("g").attr("transform","translate("+O.margins().left+","+O.margins().top+")"),h(),O},O.title(function(a){return O.cappedKeyAccessor(a)+": "+O.cappedValueAccessor(a)}),O.label(O.cappedKeyAccessor),O.measureValue=function(a){return O.cappedValueAccessor(a)},O.x=function(a){return arguments.length?(y=a,O):y},O.renderTitleLabel=function(a){return arguments.length?(N=a,O):N},O._doRedraw=function(){return h(),O},O.xAxis=function(){return P},O.fixedBarHeight=function(a){return arguments.length?(K=a,O):K},O.gap=function(a){return arguments.length?(J=a,O):J},O.elasticX=function(a){return arguments.length?(z=a,O):z},O.autoScroll=function(a){return arguments.length?(G=a,O):G},O.labelOffsetX=function(a){return arguments.length?(B=a,O):B},O.labelOffsetY=function(a){return arguments.length?(C=a,D=!0,O):C},O.titleLabelOffsetX=function(a){return arguments.length?(F=a,O):F},O.anchor(b,d)},c.cloudChart=function(b,d){function e(){l=p.data(),f(),m=a.layout.cloud().size([p.width(),p.height()]).words(l.map(function(a){return{key0:a.key0,value:a.value,color:a.color,text:a.key0,size:n(p.valueAccessor()(a))}})).rotate(function(){return 0}).font("Impact").fontSize(function(a){return a.size}).on("end",g),m.start()}function f(){var b=a.extent(l,p.cappedValueAccessor);n=a.scale.log().domain(b).range([10,Math.max(14,Math.min(p.effectiveWidth(),p.effectiveHeight())/10)])}function g(a){o=a;var b=k.attr("transform","translate("+m.size()[0]/2+","+m.size()[1]/2+")").selectAll("text").data(o);b.enter().append("text"),b.exit().remove(),b.style("font-size",function(a){return a.size+"px"}).style("font-family","Impact").style("fill",p.getColor).style("cursor","pointer").attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.key0}).on("click",h).classed("deselected",function(a){return p.hasFilter()?!j(a):!1}).classed("selected",function(a){return p.hasFilter()?j(a):!1}),i(b)}function h(a){q=!0,p.onClick(a)}function i(a){p.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(p.title()))}function j(a){return p.hasFilter(p.cappedKeyAccessor(a))}var k,l,m,n,o,p=c.capMixin(c.marginMixin(c.colorMixin(c.baseMixin({})))),q=!1,r=!1;return p.setNoRelayout=function(a){q=a},p.title(function(a){return p.cappedKeyAccessor(a)+": "+p.cappedValueAccessor(a)}),p.label(p.cappedKeyAccessor),p._doRender=function(){p.resetSvg(),k=p.svg().append("g").attr("transform","translate("+p.margins().left+","+p.margins().top+")"),q?(g(o),q=!1):e();return p},p._doRedraw=function(){return r?(q?(g(o),q=!1):e(),p):p._doRender()},p.anchor(b,d)},c.legend=function(){function a(){return j+i}var b,d,e=2,f={},g=0,h=0,i=12,j=5,k=!1,l=560,m=70,n=!1;return f.parent=function(a){return arguments.length?(b=a,f):b},f.render=function(){b.svg().select("g.dc-legend").remove(),d=b.svg().append("g").attr("class","dc-legend").attr("transform","translate("+g+","+h+")");var f=b.legendables(),o=d.selectAll("g.dc-legend-item").data(f).enter().append("g").attr("class","dc-legend-item").on("mouseover",function(a){b.legendHighlight(a)}).on("mouseout",function(a){b.legendReset(a)}).on("click",function(a){a.chart.legendToggle(a)});d.selectAll("g.dc-legend-item").classed("fadeout",function(a){return a.chart.isLegendableHidden(a)}),f.some(c.pluck("dashstyle"))?o.append("line").attr("x1",0).attr("y1",i/2).attr("x2",i).attr("y2",i/2).attr("stroke-width",2).attr("stroke-dasharray",c.pluck("dashstyle")).attr("stroke",c.pluck("color")):o.append("rect").attr("width",i).attr("height",i).attr("fill",function(a){return a?a.color:"blue"}),o.append("text").text(c.pluck("name")).attr("x",i+e).attr("y",function(){return i/2+(this.clientHeight?this.clientHeight:13)/2-2});var p=0,q=0;o.attr("transform",function(b,c){if(k){var d="translate("+p+","+q*a()+")",e=n===!0?this.getBBox().width+j:m;return p+e>=l?(++q,p=0):p+=e,d}return"translate(0,"+c*a()+")"})},f.x=function(a){return arguments.length?(g=a,f):g},f.y=function(a){return arguments.length?(h=a,f):h},f.gap=function(a){return arguments.length?(j=a,f):j},f.itemHeight=function(a){return arguments.length?(i=a,f):i},f.horizontal=function(a){return arguments.length?(k=a,f):k},f.legendWidth=function(a){return arguments.length?(l=a,f):l},f.itemWidth=function(a){return arguments.length?(m=a,f):m},f.autoItemWidth=function(a){return arguments.length?(n=a,f):n},f.legendText=function(a){return arguments.length?(_legendText=a,f):_legendText},f},c.legendContinuous=function(){function b(){return g=f.append("div").attr("class","legend-lock").classed("js-isLocked",r).on("click",c),g.append("svg").attr("class","svg-icon").classed("icon-lock",!0).attr("viewBox","0 0 48 48").append("use").attr("xlink:href","#icon-lock"),g.append("svg").attr("class","svg-icon").classed("icon-unlock",!0).attr("viewBox","0 0 48 48").append("use").attr("xlink:href","#icon-unlock"),g}function c(){r=r?!1:!0,g.classed("js-isLocked",r),r?e.legendLock()():e.legendUnlock()(!0)}function d(){var a=f.select(".legend-item:first-child .legend-input input")[0][0].value,b=f.select(".legend-item:last-child .legend-input input")[0][0].value;e.legendInputChange()([a,b],e.colors().range().length),r=!0,g.classed("js-isLocked",r)}var e,f,g,h={},i=0,j=0,k=12,l=5,m=!1,n=560,o=70,p=!1,q=!0,r=!1;return h.parent=function(a){return arguments.length?(e=a,h):e},h.render=function(){e.root().select(".legend-cont").remove(),f=e.root().append("div").attr("class","legend-cont").style("display",null===e.colorByExpr()?"none":"block");var c=(f.append("div").attr("class","legend-title").append("span").text(e.colorByExpr()),f.append("div").attr("class","legend-group"));q&&b();var g=e.legendablesContinuous(),h=c.selectAll(".legend-item").data(g).enter().append("div").attr("class","legend-item");h.append("div").attr("class","legend-swatch").style("background-color",function(a){return a?a.color:"#e2e2e2"}),h.append("div").attr("class","legend-label").append("span").text(function(a){return a?a.value:0}),c.selectAll(".legend-item:first-child , .legend-item:last-child").on("mouseenter",function(){var b=a.select(this),c=b.select("span").node().getBoundingClientRect().width+8;b.select(".legend-input input").style("width",c+"px")}).selectAll(".legend-label").append("div").attr("class","legend-input").append("input").attr("value",function(a){return a?a.value:0}).on("focus",function(){this.select();var b=a.select(this.parentNode.parentNode);b.classed("active",!0);var c=b.select("span").node().getBoundingClientRect().width+8;b.select(".legend-input input").style("width",c+"px")}).on("blur",function(){a.select(this.parentNode.parentNode).classed("active",!1)}).on("change",d)},h.x=function(a){return arguments.length?(i=a,h):i},h.y=function(a){return arguments.length?(j=a,h):j},h.gap=function(a){return arguments.length?(l=a,h):l},h.itemHeight=function(a){return arguments.length?(k=a,h):k},h.horizontal=function(a){return arguments.length?(m=a,h):m},h.legendWidth=function(a){return arguments.length?(n=a,h):n},h.itemWidth=function(a){return arguments.length?(o=a,h):o},h.autoItemWidth=function(a){return arguments.length?(p=a,h):p},h},c.scatterPlot=function(b,d){function e(b,d){var e=g.selectAll(".chart-body path.symbol").filter(function(){return b(a.select(this))}),f=h.size();h.size(Math.pow(d,2)),c.transition(e,g.transitionDuration()).attr("d",h),h.size(f)}function f(a){var b=g.selectAll(".chart-body path.symbol").each(function(b){this.filtered=a&&a.isFiltered(b.key)});c.transition(b,g.transitionDuration()).attr("d",h)}var g=c.coordinateGridMixin({}),h=a.svg.symbol(),i=function(a){return a.value},j=g.keyAccessor();g.keyAccessor(function(a){return j(a)[0]}),g.valueAccessor(function(a){return j(a)[1]}),g.colorAccessor(function(){return g._groupName});var k=function(a){return"translate("+g.x()(g.keyAccessor()(a))+","+g.y()(g.valueAccessor()(a))+")"},l=3,m=5,n=0;return h.size(function(a){return i(a)?this.filtered?Math.pow(m,2):Math.pow(l,2):n}),c.override(g,"_filter",function(a){return arguments.length?g.__filter(c.filters.RangedTwoDimensionalFilter(a)):g.__filter()}),g.plotData=function(){var a=g.chartBodyG().selectAll("path.symbol").data(g.data());a.enter().append("path").attr("class","symbol").attr("opacity",0).attr("fill",g.getColor).attr("transform",k),c.transition(a,g.transitionDuration()).attr("opacity",function(a){return i(a)?1:0}).attr("fill",g.getColor).attr("transform",k).attr("d",h),c.transition(a.exit(),g.transitionDuration()).attr("opacity",0).remove()},g.existenceAccessor=function(a){return arguments.length?(i=a,this):i},g.symbol=function(a){return arguments.length?(h.type(a),g):h.type()},g.symbolSize=function(a){return arguments.length?(l=a,g):l},g.highlightedSize=function(a){return arguments.length?(m=a,g):m},g.hiddenSize=function(a){return arguments.length?(n=a,g):n},g.legendables=function(){return[{chart:g,name:g._groupName,color:g.getColor()}]},g.legendHighlight=function(b){e(function(a){return a.attr("fill")===b.color},m),g.selectAll(".chart-body path.symbol").filter(function(){return a.select(this).attr("fill")!==b.color}).classed("fadeout",!0)},g.legendReset=function(b){e(function(a){return a.attr("fill")===b.color},l),g.selectAll(".chart-body path.symbol").filter(function(){return a.select(this).attr("fill")!==b.color}).classed("fadeout",!1)},g.setHandlePaths=function(){},g.extendBrush=function(){var a=g.brush().extent();return g.round()&&(a[0]=a[0].map(g.round()),a[1]=a[1].map(g.round()),g.g().select(".brush").call(g.brush().extent(a))),a},g.brushIsEmpty=function(a){return g.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},g._brushing=function(){var a=g.extendBrush();if(g.redrawBrush(g.g()),g.brushIsEmpty(a))c.events.trigger(function(){g.filter(null),g.redrawGroup()}),f(!1);else{var b=c.filters.RangedTwoDimensionalFilter(a);c.events.trigger(function(){g.filter(null),g.filter(b),g.redrawGroup()},c.constants.EVENT_DELAY),f(b)}},g.setBrushY=function(a){a.call(g.brush().y(g.y()))},g.anchor(b,d)},c.numberDisplay=function(b,d){var e="number-display",f=a.format(".2s"),g=c.baseMixin({}),h={one:"",some:"",none:""};return g._mandatoryAttributes(["group"]),g.html=function(a){return arguments.length?(a.none?h.none=a.none:a.one?h.none=a.one:a.some&&(h.none=a.some),a.one?h.one=a.one:a.some&&(h.one=a.some),a.some?h.some=a.some:a.one&&(h.some=a.one),g):h},g.value=function(){return g.data()},g.setDataAsync(function(a,b){a.value?a.valueAsync(b):a.topAsync(1,void 0,b)}),g.data(function(a){var b=a.value?a.value():a.top(1)[0];return g.valueAccessor()(b)}),g.transitionDuration(250),g._doRender=function(){var b=g.value(),c=g.selectAll("."+e);c.empty()&&(c=c.data([0]).enter().append("span").attr("class",e)),c.transition().duration(g.transitionDuration()).ease("quad-out-in").tween("text",function(){var c=a.interpolateNumber(this.lastValue||0,b);return this.lastValue=b,function(a){var d=null,e=g.formatNumber()(c(a));0===b&&""!==h.none?d=h.none:1===b&&""!==h.one?d=h.one:""!==h.some&&(d=h.some),this.innerHTML=d?d.replace("%number",e):e}})},g._doRedraw=function(){return g._doRender()},g.formatNumber=function(a){return arguments.length?(f=a,g):f},g.anchor(b,d)},c.heatMap=function(b,d){function e(a,b){var d=w.selectAll(".box-group").filter(function(c){var d="key"+a;return c[d]===b}),e=d.filter(function(a){return!w.hasFilter([a.key0,a.key1])});c.events.trigger(function(){e.empty()?d.each(function(a){w.filter([a.key0,a.key1])}):e.each(function(a){w.filter([a.key0,a.key1])}),w.redrawGroup()})}function f(b,c){var d=a.format(","),e=w.popup(),f=e.select(".chart-popup-box").html("").classed("popup-list",!0);f.append("div").attr("class","popup-header").text(function(){return x(w.keyAccessor()(b,c))+" x "+x(w.valueAccessor()(b,c))});var g=f.append("div").attr("class","popup-item");g.append("div").attr("class","popup-legend").style("background-color",w.getColor(b,c)),g.append("div").attr("class","popup-item-value").html(function(){return d(parseFloat(b.color.toFixed(2)))}),e.classed("js-showPopup",!0)}function g(){w.popup().classed("js-showPopup",!1)}function h(){var b=[0,0];b=a.mouse(this);var c=b[0]+w.margins().left,d=b[1]+w.margins().top,e=w.popup().attr("style",function(){return"transform:translate("+c+"px,"+d+"px)"});e.select(".chart-popup-box").classed("align-right",function(){return c+a.select(this).node().getBoundingClientRect().width>w.width()})}var i,j,k,l,m,n=6.75,o=a.ascending,p=a.ascending,q=a.scale.ordinal(),r=a.scale.ordinal(),s=n,t=n,u=a.format(".2s"),v=!1,s=n,t=n,w=c.colorMixin(c.marginMixin(c.baseMixin({})));w._mandatoryAttributes(["group"]),w.title(w.colorAccessor());var x=function(a){return isNaN(a)?a:u(a).match(/[a-z]/i)?u(a):parseFloat(u(a))},y=function(a){return isNaN(a)?a:u(a).match(/[a-z]/i)?u(a):parseFloat(u(a))};w.colsLabel=function(a){return arguments.length?(x=a,w):x},w.rowsLabel=function(a){return arguments.length?(y=a,w):y},w.setLabels=function(a,b){m=a,l=b};var z=function(a){var b=INTERVAL_LABELS.DAY_OF_WEEK.indexOf(a),c=INTERVAL_LABELS.MONTH.indexOf(a),d=INTERVAL_LABELS.HOUR_OF_DAY.indexOf(a);b>-1?e(0,b):c>-1?e(0,c):d>-1?e(0,d):e(0,a)},A=function(a){var b=INTERVAL_LABELS.DAY_OF_WEEK.indexOf(a),c=INTERVAL_LABELS.MONTH.indexOf(a),d=INTERVAL_LABELS.HOUR_OF_DAY.indexOf(a);b>-1?e(1,b):c>-1?e(1,c):d>-1?e(1,d):e(1,a)},B=function(a){var b=[a.key0,a.key1];c.events.trigger(function(){w.filter(b),w.redrawGroup()})};return c.override(w,"filter",function(a){return arguments.length?w._filter(c.filters.TwoDimensionalFilter(a)):w._filter()}),w.rows=function(a){return arguments.length?(k=a,w):k},w.rowOrdering=function(a){return arguments.length?(p=a,w):p},w.cols=function(a){return arguments.length?(j=a,w):j},w.colOrdering=function(a){return arguments.length?(o=a,w):o},w._doRender=function(){return w.resetSvg(),w.margins({top:8,right:16,bottom:56,left:48}),i=w.svg().append("g").attr("class","heatmap").attr("transform","translate("+w.margins().left+","+w.margins().top+")"),i.append("g").attr("class","box-wrapper"),v=!0,w._doRedraw()},w._doRedraw=function(){if(!v)return w._doRender();var a=w.data(),b=w.cols(),d=w.rows()||a.map(w.valueAccessor()),b=w.cols()||a.map(w.keyAccessor());p&&(d=d.sort(p)),o&&(b=b.sort(o)),d=r.domain(d),b=q.domain(b);var e=d.domain().length,j=b.domain().length,k=Math.floor(w.effectiveWidth()/j),l=Math.floor(w.effectiveHeight()/e);b.rangeRoundBands([0,w.effectiveWidth()]),d.rangeRoundBands([w.effectiveHeight(),0]);var m=i.select(".box-wrapper").selectAll("g.box-group").data(w.data(),function(a,b){return w.keyAccessor()(a,b)+"\x00"+w.valueAccessor()(a,b)}),n=m.enter().append("g").attr("class","box-group");n.append("rect").attr("class","heat-box").attr("fill","white").on("mouseenter",f).on("mousemove",h).on("mouseleave",g).on("click",w.boxOnClick()),c.transition(m.select("rect"),w.transitionDuration()).attr("x",function(a,c){return b(w.keyAccessor()(a,c))}).attr("y",function(a,b){return d(w.valueAccessor()(a,b))}).attr("rx",s).attr("ry",t).attr("fill",w.getColor).attr("width",k).attr("height",l),m.exit().remove();var u=i.selectAll("g.cols");u.empty()&&(u=i.append("g").attr("class","cols axis"));var x=function(){var a=0;return b.domain().forEach(function(b){a=b.toString().length>a?b.toString().length:a}),a},y=8*x()>k?!0:!1,z=u.selectAll("text").data(b.domain());z.enter().append("text").attr("x",function(a){return b(a)+k/2}).attr("y",w.effectiveHeight()).on("click",w.xAxisOnClick()).text(w.colsLabel()).style("text-anchor",function(a){return y?isNaN(a)?"start":"end":"middle"}).attr("dy",y?3:12).attr("dx",function(a){return y?isNaN(a)?2:-4:0}).attr("transform",function(a){return y?"rotate(-90, "+(b(a)+k/2)+", "+w.effectiveHeight()+")":null}),c.transition(z,w.transitionDuration()).text(w.colsLabel()).attr("x",function(a){return b(a)+k/2}).attr("y",w.effectiveHeight()).style("text-anchor",function(a){return y?isNaN(a)?"start":"end":"middle"}).attr("dy",y?3:12).attr("dx",function(a){return y?isNaN(a)?2:-4:0}).attr("transform",function(a){return y?"rotate(-90, "+(b(a)+k/2)+", "+w.effectiveHeight()+")":null}),z.exit().remove();var A=i.selectAll("g.rows");A.empty()&&(A=i.append("g").attr("class","rows axis"));var B=A.selectAll("text").data(d.domain());return B.enter().append("text").attr("dy",6).style("text-anchor","end").attr("x",0).attr("dx",-2).on("click",w.yAxisOnClick()).text(w.rowsLabel()),c.transition(B,w.transitionDuration()).text(w.rowsLabel()).attr("y",function(a){return d(a)+l/2}),B.exit().remove(),w.hasFilter()?w.selectAll("g.box-group").each(function(a){w.isSelectedNode(a)?w.highlightSelected(this):w.fadeDeselected(this)}):w.selectAll("g.box-group").each(function(){w.resetHighlight(this)}),w.renderAxisLabels(),w},w.boxOnClick=function(a){return arguments.length?(B=a,w):B},w.xAxisOnClick=function(a){return arguments.length?(z=a,w):z},w.yAxisOnClick=function(a){return arguments.length?(A=a,w):A},w.xBorderRadius=function(a){return arguments.length?(s=a,w):s},w.renderAxisLabels=function(){var a=w.root(),b=a.selectAll(".y-axis-label");b.empty()&&(b=a.append("div").attr("class","y-axis-label").text(l)),b.style("top",w.effectiveHeight()/2+w.margins().top+"px");var c=a.selectAll(".x-axis-label");c.empty()&&(c=a.append("div").attr("class","x-axis-label").text(m)),c.style("left",w.effectiveWidth()/2+w.margins().left+"px")},w.yBorderRadius=function(a){return arguments.length?(t=a,w):t},w.isSelectedNode=function(a){return w.hasFilter([a.key0,a.key1])},w.anchor(b,d)},function(){function b(a){return[0,a.length-1]}function c(b){return[a.quantile(b,.25),a.quantile(b,.5),a.quantile(b,.75)]}a.box=function(){function d(b){b.each(function(b,c){b=b.map(i).sort(a.ascending);var d=a.select(this),m=b.length,n=b[0],o=b[m-1],p=b.quartiles=k(b),q=j&&j.call(this,b,c),r=q&&q.map(function(a){return b[a]}),s=q?a.range(0,q[0]).concat(a.range(q[1]+1,m)):a.range(m),t=a.scale.linear().domain(h&&h.call(this,b,c)||[n,o]).range([f,0]),u=this.__chart__||a.scale.linear().domain([0,1/0]).range(t.range());this.__chart__=t;var v=d.selectAll("line.center").data(r?[r]:[]);v.enter().insert("line","rect").attr("class","center").attr("x1",e/2).attr("y1",function(a){return u(a[0])}).attr("x2",e/2).attr("y2",function(a){return u(a[1])}).style("opacity",1e-6).transition().duration(g).style("opacity",1).attr("y1",function(a){return t(a[0])}).attr("y2",function(a){return t(a[1])}),v.transition().duration(g).style("opacity",1).attr("y1",function(a){return t(a[0])}).attr("y2",function(a){return t(a[1])}),v.exit().transition().duration(g).style("opacity",1e-6).attr("y1",function(a){return t(a[0])}).attr("y2",function(a){return t(a[1])}).remove();var w=d.selectAll("rect.box").data([p]);w.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(a){return u(a[2])}).attr("width",e).attr("height",function(a){return u(a[0])-u(a[2])}).transition().duration(g).attr("y",function(a){return t(a[2])}).attr("height",function(a){return t(a[0])-t(a[2])}),w.transition().duration(g).attr("y",function(a){return t(a[2])}).attr("height",function(a){return t(a[0])-t(a[2])});var x=d.selectAll("line.median").data([p[1]]);x.enter().append("line").attr("class","median").attr("x1",0).attr("y1",u).attr("x2",e).attr("y2",u).transition().duration(g).attr("y1",t).attr("y2",t),x.transition().duration(g).attr("y1",t).attr("y2",t);var y=d.selectAll("line.whisker").data(r||[]);y.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",u).attr("x2",e).attr("y2",u).style("opacity",1e-6).transition().duration(g).attr("y1",t).attr("y2",t).style("opacity",1),y.transition().duration(g).attr("y1",t).attr("y2",t).style("opacity",1),y.exit().transition().duration(g).attr("y1",t).attr("y2",t).style("opacity",1e-6).remove();var z=d.selectAll("circle.outlier").data(s,Number);z.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",function(a){return u(b[a])}).style("opacity",1e-6).transition().duration(g).attr("cy",function(a){return t(b[a])}).style("opacity",1),z.transition().duration(g).attr("cy",function(a){return t(b[a])}).style("opacity",1),z.exit().transition().duration(g).attr("cy",function(a){return t(b[a])}).style("opacity",1e-6).remove();var A=l||t.tickFormat(8),B=d.selectAll("text.box").data(p);B.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(a,b){return 1&b?6:-6}).attr("x",function(a,b){return 1&b?e:0}).attr("y",u).attr("text-anchor",function(a,b){return 1&b?"start":"end"}).text(A).transition().duration(g).attr("y",t),B.transition().duration(g).text(A).attr("y",t);var C=d.selectAll("text.whisker").data(r||[]);C.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",u).text(A).style("opacity",1e-6).transition().duration(g).attr("y",t).style("opacity",1),C.transition().duration(g).text(A).attr("y",t).style("opacity",1),C.exit().transition().duration(g).attr("y",t).style("opacity",1e-6).remove()}),a.timer.flush()}var e=1,f=1,g=0,h=null,i=Number,j=b,k=c,l=null;return d.width=function(a){return arguments.length?(e=a,d):e},d.height=function(a){return arguments.length?(f=a,d):f},d.tickFormat=function(a){return arguments.length?(l=a,d):l},d.duration=function(a){return arguments.length?(g=a,d):g},d.domain=function(b){return arguments.length?(h=null===b?b:a.functor(b),d):h},d.value=function(a){return arguments.length?(i=a,d):i},d.whiskers=function(a){return arguments.length?(j=a,d):j},d.quartiles=function(a){return arguments.length?(k=a,d):k},d}}(),c.boxPlot=function(b,d){function e(a){return function(b){var c=b.quartiles[0],d=b.quartiles[2],e=(d-c)*a,f=-1,g=b.length;do++f;while(b[f]<c-e);do--g;while(b[g]>d+e);return[f,g]}}function f(a){var b=a.enter().append("g");b.attr("class","box").attr("transform",p).call(m).on("click",function(a){i.filter(a.key),i.redrawGroup()})}function g(b){c.transition(b,i.transitionDuration()).attr("transform",p).call(m).each(function(){a.select(this).select("rect.box").attr("fill",i.getColor)})}function h(a){a.exit().remove().call(m)}var i=c.coordinateGridMixin({}),j=1.5,k=e,l=k(j),m=a.box(),n=null,o=function(a,b){return i.isOrdinal()?i.x().rangeBand():a/(1+i.boxPadding())/b};i.yAxisPadding(12),i.x(a.scale.ordinal()),i.xUnits(c.units.ordinal),i.data(function(a){return a.all().map(function(a){return a.map=function(b){return b.call(a,a)},a}).filter(function(a){var b=i.valueAccessor()(a);return 0!==b.length})}),i.boxPadding=i._rangeBandPadding,i.boxPadding(.8),i.outerPadding=i._outerRangeBandPadding,i.outerPadding(.5),i.boxWidth=function(b){return arguments.length?(o=a.functor(b),i):o};var p=function(a,b){var c=i.x()(i.keyAccessor()(a,b));return"translate("+c+", 0)"};return i._preprocessData=function(){i.elasticX()&&i.x().domain([])},i.plotData=function(){var a=o(i.effectiveWidth(),i.xUnitCount());m.whiskers(l).width(a).height(i.effectiveHeight()).value(i.valueAccessor()).domain(i.y().domain()).duration(i.transitionDuration()).tickFormat(n);var b=i.chartBodyG().selectAll("g.box").data(i.data(),function(a){return a.key});f(b),g(b),h(b),i.fadeDeselectedArea()},i.fadeDeselectedArea=function(){i.hasFilter()?i.g().selectAll("g.box").each(function(a){i.isSelectedNode(a)?i.highlightSelected(this):i.fadeDeselected(this)}):i.g().selectAll("g.box").each(function(){i.resetHighlight(this)})},i.isSelectedNode=function(a){return i.hasFilter(a.key)},i.yAxisMin=function(){var b=a.min(i.data(),function(b){return a.min(i.valueAccessor()(b))});return c.utils.subtract(b,i.yAxisPadding())},i.yAxisMax=function(){var b=a.max(i.data(),function(b){return a.max(i.valueAccessor()(b))});return c.utils.add(b,i.yAxisPadding())},i.tickFormat=function(a){return arguments.length?(n=a,i):n},i.anchor(b,d)},c.abstractBubbleChart=c.bubbleMixin,c.baseChart=c.baseMixin,c.capped=c.capMixin,c.colorChart=c.colorMixin,c.coordinateGridChart=c.coordinateGridMixin,c.marginable=c.marginMixin,c.stackableChart=c.stackMixin,c.d3=a,c.crossfilter=b,c}if("function"==typeof define&&define.amd){var b=require("d3"),c=require("@mapd/mapd-crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c)}else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("@mapd/mapd-crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c);
}else this.dc=a(d3,crossfilter)}();
//# sourceMappingURL=mapdc.min.js.map